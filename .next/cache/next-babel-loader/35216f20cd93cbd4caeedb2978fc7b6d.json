{"ast":null,"code":"import _Object$defineProperty from \"@babel/runtime-corejs2/core-js/object/define-property\";\nimport _Object$defineProperties from \"@babel/runtime-corejs2/core-js/object/define-properties\";\nimport _Object$getOwnPropertyDescriptors from \"@babel/runtime-corejs2/core-js/object/get-own-property-descriptors\";\nimport _Object$getOwnPropertyDescriptor from \"@babel/runtime-corejs2/core-js/object/get-own-property-descriptor\";\nimport _Object$getOwnPropertySymbols from \"@babel/runtime-corejs2/core-js/object/get-own-property-symbols\";\nimport _Object$keys from \"@babel/runtime-corejs2/core-js/object/keys\";\nimport _toConsumableArray from \"@babel/runtime-corejs2/helpers/esm/toConsumableArray\";\nimport _classCallCheck from \"@babel/runtime-corejs2/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime-corejs2/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"@babel/runtime-corejs2/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime-corejs2/helpers/esm/getPrototypeOf\";\nimport _assertThisInitialized from \"@babel/runtime-corejs2/helpers/esm/assertThisInitialized\";\nimport _inherits from \"@babel/runtime-corejs2/helpers/esm/inherits\";\nimport _defineProperty from \"@babel/runtime-corejs2/helpers/esm/defineProperty\";\nimport React from \"react\";\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = _Object$keys(object); if (_Object$getOwnPropertySymbols) { var symbols = _Object$getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return _Object$getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (_Object$getOwnPropertyDescriptors) { _Object$defineProperties(target, _Object$getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { _Object$defineProperty(target, key, _Object$getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport gql from 'graphql-tag';\nimport { Query, Mutation } from 'react-apollo';\nimport { Card, ResourceList, Stack, TextStyle, ResourceItem, TextField, Thumbnail, DataTable, Button, Checkbox, Icon, Toast, Frame } from '@shopify/polaris';\nimport { StarFilledMinor, StarOutlineMinor } from '@shopify/polaris-icons';\nimport store from 'store-js';\nimport { Redirect } from '@shopify/app-bridge/actions';\nimport { Context } from '@shopify/app-bridge-react';\nimport { useMutation } from '@apollo/react-hooks';\nimport _ from 'lodash';\nimport './ResourceList.css';\nimport { UPDATE_PRODUCTS, SEARCH_PRODUCTS } from \"./graphql.js\";\n\nvar ResourceListWithProducts =\n/*#__PURE__*/\nfunction (_React$Component) {\n  _inherits(ResourceListWithProducts, _React$Component);\n\n  function ResourceListWithProducts() {\n    var _getPrototypeOf2;\n\n    var _this;\n\n    _classCallCheck(this, ResourceListWithProducts);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _possibleConstructorReturn(this, (_getPrototypeOf2 = _getPrototypeOf(ResourceListWithProducts)).call.apply(_getPrototypeOf2, [this].concat(args)));\n\n    _defineProperty(_assertThisInitialized(_this), \"state\", {\n      favorites: {},\n      bundles: {},\n      selectedItems: [],\n      loading: \"\",\n      toasts: []\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"transformData\", function (data, searchquery, replacestring, scopes, matchcase) {\n      var regsearchquery = new RegExp(searchquery, _this.getRegexCase(matchcase));\n      var result = {\n        id: data.id\n      };\n      scopes.map(function (sco) {\n        if (sco === \"tags\") {\n          result[sco] = data[sco].map(function (tag) {\n            return tag.replace(regsearchquery, replacestring);\n          });\n        } else if (sco === \"description\") {\n          result[\"descriptionHtml\"] = data[sco].replace(regsearchquery, replacestring);\n        } else {\n          result[sco] = data[sco].replace(regsearchquery, replacestring);\n        }\n      });\n      console.log(result);\n      return result;\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleReplace\", function (products, searchquery, replacestring, scopes, matchcase) {\n      if (!products || products.edges.length < 1) {\n        return;\n      }\n\n      var promises = _this.state.products.edges.length;\n      var count = promises;\n      products.edges.map(function (item) {\n        _this.props.apolloClient.mutate({\n          mutation: UPDATE_PRODUCTS,\n          variables: {\n            input: _this.transformData(item.node, searchquery, replacestring, scopes, matchcase)\n          }\n        }).then(function (response) {\n          console.log(response);\n          count -= 1;\n\n          if (count === 0) {\n            _this.setState({\n              toasts: [].concat(_toConsumableArray(_this.state.toasts), [{\n                key: _this.randomString(10),\n                content: \"\".concat(promises, \" products changed.\")\n              }])\n            });\n          }\n        });\n      });\n    });\n\n    return _this;\n  }\n\n  _createClass(ResourceListWithProducts, [{\n    key: \"randomString\",\n    value: function randomString(length) {\n      return Math.round(Math.pow(36, length + 1) - Math.random() * Math.pow(36, length)).toString(36).slice(1);\n    }\n  }, {\n    key: \"getRegexCase\",\n    value: function getRegexCase(matchcase) {\n      return matchcase ? \"g\" : \"gi\";\n    }\n  }, {\n    key: \"setSelectedItems\",\n    value: function setSelectedItems(selectedItems) {\n      console.log(selectedItems);\n      return this.setState({\n        selectedItems: selectedItems\n      });\n    }\n  }, {\n    key: \"ObjtoArray\",\n    value: function ObjtoArray(obj) {\n      return _Object$keys(obj).map(function (key) {\n        return _objectSpread({}, obj[key], {\n          key: key\n        });\n      });\n    }\n  }, {\n    key: \"ArrayobjtoArray\",\n    value: function ArrayobjtoArray(obj) {\n      return _Object$keys(obj).map(function (key) {\n        return {\n          content: obj[key],\n          key: key\n        };\n      });\n    }\n  }, {\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var favorites = store.get(\"favorite\") ? store.get(\"favorite\") : {};\n      var bundles = store.get(\"bundle\") ? store.get(\"bundle\") : {}; // if(Object.keys.length(bundles)===0){\n      //     store.set(\"bundle\",{})\n      // }\n\n      console.log(favorites);\n      console.log(bundles);\n      this.setState({\n        favorites: favorites,\n        bundles: bundles\n      });\n    }\n  }, {\n    key: \"runFavorite\",\n    value: function runFavorite(key) {\n      var _this2 = this;\n\n      var _this$state$favorites = this.state.favorites[key],\n          searchquery = _this$state$favorites.searchquery,\n          replacestring = _this$state$favorites.replacestring,\n          scopes = _this$state$favorites.scopes,\n          matchcase = _this$state$favorites.matchcase;\n      this.props.apolloClient.query({\n        query: SEARCH_PRODUCTS,\n        variables: {\n          searchquery: searchquery\n        }\n      }).then(function (response) {\n        console.log(response);\n\n        if (response && response.data && response.data.products) {\n          _this2.setState({\n            loading: key\n          });\n\n          _this2.handleReplace(response.data.products, searchquery, replacestring, scopes, matchcase);\n        } else {\n          console.log(\"no item found\");\n        }\n      });\n    }\n  }, {\n    key: \"removeFavorite\",\n    value: function removeFavorite(key) {\n      var favorites = this.state.favorites;\n      delete favorites[key];\n      store.set(\"favorite\", favorites);\n      this.setState({\n        favorites: favorites\n      });\n    }\n  }, {\n    key: \"createBundle\",\n    value: function createBundle() {\n      var _this$state = this.state,\n          favorites = _this$state.favorites,\n          bundles = _this$state.bundles;\n      var newbundle = this.state.selectedItems.reduce(function (bundle, key) {\n        console.log(bundle);\n        var fav = favorites[key];\n        console.log(fav);\n        delete favorites[key];\n        return [].concat(_toConsumableArray(bundle), [fav]);\n      }, []);\n      var newbundlekey = \"bundle:\" + this.state.selectedItems.join(';');\n      console.log(newbundle);\n      console.log(newbundlekey);\n      console.log(favorites);\n      store.set(\"favorite\", favorites);\n      var newbundles;\n\n      if (!store.get('bundle')) {\n        console.log(\"no current bundle\");\n        newbundles = _defineProperty({}, newbundlekey, newbundle);\n      } else {\n        newbundles = _objectSpread({}, bundles, _defineProperty({}, newbundlekey, newbundle));\n      }\n\n      store.set(\"bundle\", newbundles);\n      this.setState({\n        selectedItems: [],\n        favorites: favorites,\n        bundles: newbundles\n      });\n    }\n  }, {\n    key: \"unbundle\",\n    value: function unbundle(key) {\n      var _this$state2 = this.state,\n          favorites = _this$state2.favorites,\n          bundles = _this$state2.bundles;\n      var bundle = bundles[key];\n      bundle.map(function (fav) {\n        var hashedfav = _Object$keys(fav).sort().map(function (x) {\n          return fav[x].toString();\n        }).join(\";\");\n\n        favorites[hashedfav] = fav;\n      });\n      delete bundles[key];\n      console.log(bundles);\n      console.log(favorites);\n      store.set(\"favorite\", favorites);\n      store.set(\"bundle\", bundles);\n      this.setState({\n        favorites: favorites,\n        bundles: bundles\n      });\n    }\n  }, {\n    key: \"runBundle\",\n    value: function runBundle(key) {\n      var _this3 = this;\n\n      var bundle = this.state.bundles[key];\n      bundle.map(function (fav) {\n        var searchquery = fav.searchquery,\n            replacestring = fav.replacestring,\n            scopes = fav.scopes,\n            matchcase = fav.matchcase;\n\n        _this3.props.apolloClient.query({\n          query: SEARCH_PRODUCTS,\n          variables: {\n            searchquery: searchquery\n          }\n        }).then(function (response) {\n          console.log(response);\n\n          if (response && response.data && response.data.products) {\n            _this3.handleReplace(response.data.products, searchquery, replacestring, scopes, matchcase);\n          } else {\n            console.log(\"no item found\");\n          }\n        });\n      });\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this4 = this;\n\n      var toastMarkup = this.state.toasts.map(function (toast) {\n        return __jsx(Toast, {\n          content: toast.content,\n          onDismiss: function onDismiss() {\n            return _this4.setState({\n              toasts: _this4.state.toasts.filter(function (to) {\n                return to.key !== toast.key;\n              })\n            });\n          }\n        });\n      });\n      return __jsx(Frame, null, __jsx(Card, null, __jsx(ResourceList, {\n        resourceName: {\n          singular: 'favorite',\n          plural: 'favorites'\n        },\n        items: this.ObjtoArray(this.state.favorites),\n        selectedItems: this.state.selectedItems,\n        onSelectionChange: this.setSelectedItems.bind(this),\n        selectable: true,\n        promotedBulkActions: [{\n          content: 'Bundle',\n          onAction: function onAction() {\n            return _this4.createBundle();\n          }\n        }],\n        renderItem: function renderItem(item) {\n          var key = item.key,\n              searchquery = item.searchquery,\n              replacestring = item.replacestring,\n              matchcase = item.matchcase,\n              scopes = item.scopes;\n          var shortcutActions = [{\n            content: 'Run',\n            loading: true,\n            onAction: function onAction() {\n              return _this4.runFavorite(key);\n            }\n          }, {\n            content: 'Remove',\n            onAction: function onAction() {\n              return _this4.removeFavorite(key);\n            }\n          }];\n          return __jsx(ResourceItem, {\n            id: key,\n            shortcutActions: shortcutActions,\n            persistActions: true,\n            name: searchquery\n          }, __jsx(\"h3\", null, __jsx(TextStyle, {\n            variation: \"strong\"\n          }, searchquery, \" | \"), __jsx(TextStyle, {\n            variation: \"subdued\"\n          }, \"in (\", scopes.toString(), \")\")), __jsx(\"div\", null, \"Replace with :\\\"\", replacestring, \"\\\" \", matchcase ? \"(Case Sensitive)\" : \"(Case Insensitive)\"));\n        }\n      })), __jsx(Card, null, __jsx(ResourceList, {\n        resourceName: {\n          singular: 'bundle',\n          plural: 'bundles'\n        },\n        items: this.ArrayobjtoArray(this.state.bundles),\n        renderItem: function renderItem(item) {\n          var key = item.key,\n              content = item.content;\n          console.log(item);\n          var shortcutActions = [{\n            content: 'Run',\n            onAction: function onAction() {\n              return _this4.runBundle(key);\n            }\n          }, {\n            content: 'Unbundle',\n            onAction: function onAction() {\n              return _this4.unbundle(key);\n            }\n          }];\n          return __jsx(ResourceItem, {\n            id: key,\n            shortcutActions: shortcutActions\n          }, __jsx(\"h3\", null, __jsx(TextStyle, {\n            variation: \"strong\"\n          }, \"Bundle\")), content.map(function (item) {\n            return __jsx(\"div\", null, \"Find: \\\"\", item.searchquery, \"\\\" in (\", item.scopes.toString(), \"); Replace with :\\\"\", item.replacestring, \"\\\" \", item.matchcase ? \"(Case Sensitive)\" : \"(Case Insensitive)\");\n          }));\n        }\n      })), this.state.showtoast ? __jsx(Toast, {\n        content: this.state.toastcontent,\n        onDismiss: function onDismiss() {\n          return _this4.setState({\n            showtoast: false\n          });\n        }\n      }) : null, toastMarkup);\n    }\n  }]);\n\n  return ResourceListWithProducts;\n}(React.Component);\n\n_defineProperty(ResourceListWithProducts, \"contextType\", Context);\n\nexport default ResourceListWithProducts;","map":{"version":3,"sources":["/home/edwang09/Documents/Upwork/Shopify/components/FavoriteList.js"],"names":["gql","Query","Mutation","Card","ResourceList","Stack","TextStyle","ResourceItem","TextField","Thumbnail","DataTable","Button","Checkbox","Icon","Toast","Frame","StarFilledMinor","StarOutlineMinor","store","Redirect","Context","useMutation","_","UPDATE_PRODUCTS","SEARCH_PRODUCTS","ResourceListWithProducts","favorites","bundles","selectedItems","loading","toasts","data","searchquery","replacestring","scopes","matchcase","regsearchquery","RegExp","getRegexCase","result","id","map","sco","tag","replace","console","log","products","edges","length","promises","state","count","item","props","apolloClient","mutate","mutation","variables","input","transformData","node","then","response","setState","key","randomString","content","Math","round","pow","random","toString","slice","obj","get","query","handleReplace","set","newbundle","reduce","bundle","fav","newbundlekey","join","newbundles","hashedfav","sort","x","toastMarkup","toast","filter","to","singular","plural","ObjtoArray","setSelectedItems","bind","onAction","createBundle","shortcutActions","runFavorite","removeFavorite","ArrayobjtoArray","runBundle","unbundle","showtoast","toastcontent","React","Component"],"mappings":"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","sourcesContent":["import gql from 'graphql-tag';\nimport { Query, Mutation } from 'react-apollo';\nimport { Card,\n    ResourceList,\n    Stack,\n    TextStyle,\n    ResourceItem,\n    TextField,\n    Thumbnail,\n    DataTable,\n    Button,\n    Checkbox,\n    Icon,\n    Toast,\n    Frame\n } from '@shopify/polaris';\n import {\n  StarFilledMinor,\n  StarOutlineMinor\n} from '@shopify/polaris-icons';\nimport store from 'store-js';\nimport { Redirect } from '@shopify/app-bridge/actions';\nimport { Context } from '@shopify/app-bridge-react';\nimport { useMutation } from '@apollo/react-hooks';\nimport _ from 'lodash'\nimport './ResourceList.css'\nimport{ UPDATE_PRODUCTS, SEARCH_PRODUCTS }from \"./graphql.js\"\n\nclass ResourceListWithProducts extends React.Component {\n    static contextType = Context;\n    state = {\n        favorites:{},\n        bundles:{},\n        selectedItems: [],\n        loading: \"\",\n        toasts:[]\n\n    }\n    randomString(length) {\n        return Math.round((Math.pow(36, length + 1) - Math.random() * Math.pow(36, length))).toString(36).slice(1);\n    }\n    getRegexCase(matchcase){return matchcase ? \"g\" : \"gi\"}\n    transformData = (data, searchquery, replacestring, scopes, matchcase)=>{\n        const regsearchquery = new RegExp(searchquery, this.getRegexCase(matchcase));\n        let result = {id:data.id}\n        scopes.map(sco=>{\n            if(sco===\"tags\"){\n                result[sco] = data[sco].map(tag=>tag.replace(regsearchquery, replacestring))\n            }else if(sco===\"description\"){\n                result[\"descriptionHtml\"] = data[sco].replace(regsearchquery, replacestring)\n            }else{\n                result[sco] = data[sco].replace(regsearchquery, replacestring)\n            }\n        })\n        console.log(result)\n        return result\n    }\n    handleReplace = (products, searchquery, replacestring, scopes, matchcase) => {\n        if(!products || products.edges.length<1){\n            return \n        }\n        const promises = this.state.products.edges.length\n        let count = promises\n        products.edges.map(item=>{\n            this.props.apolloClient.mutate({\n                mutation: UPDATE_PRODUCTS,\n                variables:{input:this.transformData(item.node, searchquery, replacestring, scopes, matchcase)}\n            })\n            .then(response=>{\n                console.log(response)\n                count -= 1\n                if(count === 0){\n                  this.setState({ toasts: [...this.state.toasts, {key: this.randomString(10), content: `${promises} products changed.`}] })\n                }\n            })\n        })\n    }\n\n    setSelectedItems(selectedItems){\n        console.log(selectedItems)\n        return this.setState({selectedItems})\n    }\n\n    ObjtoArray(obj){\n        return Object.keys(obj).map((key)=>{\n            return {...obj[key], key}\n        })\n    }\n    ArrayobjtoArray(obj){\n        return Object.keys(obj).map((key)=>{\n            return {content: obj[key], key}\n        })\n    }\n    componentDidMount(){\n        const favorites = store.get(\"favorite\") ? store.get(\"favorite\") : {}\n        const bundles = store.get(\"bundle\") ? store.get(\"bundle\") : {}\n        // if(Object.keys.length(bundles)===0){\n        //     store.set(\"bundle\",{})\n        // }\n        console.log(favorites)\n        console.log(bundles)\n        this.setState({favorites, bundles})\n    }\n    runFavorite(key){\n        const  {searchquery, replacestring, scopes, matchcase} = this.state.favorites[key]\n        this.props.apolloClient.query({\n            query: SEARCH_PRODUCTS,\n            variables:{searchquery}\n        })\n        .then(response=>{\n            console.log(response)\n            if(response && response.data && response.data.products){\n                this.setState({loading:key})\n                this.handleReplace(response.data.products,searchquery, replacestring, scopes, matchcase)\n            }else{\n                console.log(\"no item found\")\n            }\n        })\n    }\n    removeFavorite(key){\n        const { favorites } = this.state\n        delete favorites[key]\n        store.set(\"favorite\",favorites)\n        this.setState({favorites})\n    }\n\n    createBundle(){\n        const { favorites, bundles } = this.state\n        const newbundle = this.state.selectedItems.reduce((bundle, key)=>{\n            console.log(bundle)\n            const fav = favorites[key]\n            console.log(fav)\n            delete favorites[key]\n            return [...bundle,fav]\n        },[])\n        const newbundlekey = \"bundle:\"+this.state.selectedItems.join(';')\n        console.log(newbundle)\n        console.log(newbundlekey)\n        console.log(favorites)\n        store.set(\"favorite\",favorites)\n        let newbundles\n        if (!store.get('bundle')){\n            console.log(\"no current bundle\")\n            newbundles = {[newbundlekey]:newbundle}\n        }else{\n            newbundles = {...bundles, [newbundlekey]:newbundle}\n        }\n        store.set(\"bundle\",newbundles)\n        this.setState({selectedItems:[], favorites, bundles: newbundles})\n    }\n    \n    unbundle(key){\n        const { favorites, bundles } = this.state\n        const bundle = bundles[key]\n        bundle.map(fav => {\n            const hashedfav = Object.keys(fav).sort().map(x => fav[x].toString()).join(\";\");\n            favorites[hashedfav] = fav\n        })\n        delete bundles[key]\n        console.log(bundles)\n        console.log(favorites)\n        store.set(\"favorite\",favorites)\n        store.set(\"bundle\",bundles)\n        this.setState({favorites, bundles})\n    }\n\n    runBundle(key){\n        const bundle = this.state.bundles[key]\n        bundle.map(fav => {\n            const  {searchquery, replacestring, scopes, matchcase} = fav\n            this.props.apolloClient.query({\n                query: SEARCH_PRODUCTS,\n                variables:{searchquery}\n            })\n            .then(response=>{\n                console.log(response)\n                if(response && response.data && response.data.products){\n                    this.handleReplace(response.data.products,searchquery, replacestring, scopes, matchcase)\n                }else{\n                    console.log(\"no item found\")\n                }\n            })\n        })\n    }\n    \n    render() {\n      const toastMarkup = this.state.toasts.map(toast=>{\n          return  (<Toast content={toast.content} onDismiss={()=>this.setState({toasts:this.state.toasts.filter(to=>to.key !== toast.key)})}/>)\n      })\n    return (\n        <Frame>\n        <Card>\n        <ResourceList\n            resourceName={{singular: 'favorite', plural: 'favorites'}}\n            items={this.ObjtoArray(this.state.favorites)}\n            selectedItems={this.state.selectedItems}\n            onSelectionChange={this.setSelectedItems.bind(this)}\n            selectable\n            promotedBulkActions={[\n                {\n                  content: 'Bundle',\n                  onAction: ()=>this.createBundle(),\n                }\n            ]}\n            renderItem={(item) => {\n            const {key, searchquery, replacestring, matchcase, scopes} = item;\n            const shortcutActions = [\n                {\n                    content: 'Run',\n                    loading:true,\n                    onAction: ()=>this.runFavorite(key),\n                }, {\n                    content: 'Remove',\n                    onAction: ()=>this.removeFavorite(key),\n                }]\n              \n            return (\n                <ResourceItem\n                id={key}\n                shortcutActions={shortcutActions}\n                persistActions\n                name={searchquery}\n                >\n                <h3>\n                <TextStyle variation=\"strong\">{searchquery} | </TextStyle>\n                <TextStyle variation=\"subdued\">in ({scopes.toString()})</TextStyle>\n                </h3>\n                <div>Replace with :\"{replacestring}\" {matchcase ? \"(Case Sensitive)\" : \"(Case Insensitive)\"}</div>\n                </ResourceItem>\n            );\n            }}\n        />\n        </Card>\n\n        <Card>\n        <ResourceList\n            resourceName={{singular: 'bundle', plural: 'bundles'}}\n            items={this.ArrayobjtoArray(this.state.bundles)}\n            renderItem={(item) => {\n            const {key, content} = item;\n            console.log(item)\n            const shortcutActions = [\n                {\n                    content: 'Run',\n                    onAction: ()=>this.runBundle(key),\n                }, {\n                    content: 'Unbundle',\n                    onAction: ()=>this.unbundle(key),\n                }]\n              \n            return (\n                <ResourceItem\n                id={key}\n                shortcutActions={shortcutActions}\n                >\n                <h3>\n                    <TextStyle variation=\"strong\">Bundle</TextStyle>\n                </h3>\n                {content.map((item)=>{\n                    return (<div>Find: \"{item.searchquery}\" in ({item.scopes.toString()}); Replace with :\"{item.replacestring}\" {item.matchcase ? \"(Case Sensitive)\" : \"(Case Insensitive)\"}</div>)\n                })}\n                </ResourceItem>\n            );\n            }}\n        />\n        </Card>\n        {this.state.showtoast ? (<Toast content={this.state.toastcontent} onDismiss={() => this.setState({showtoast:false})} />) : null}\n        {toastMarkup}\n        </Frame>\n    );\n  }\n}\n\n export default ResourceListWithProducts;"]},"metadata":{},"sourceType":"module"}