{"ast":null,"code":"import _Object$defineProperty from \"@babel/runtime-corejs2/core-js/object/define-property\";\nimport _Object$defineProperties from \"@babel/runtime-corejs2/core-js/object/define-properties\";\nimport _Object$getOwnPropertyDescriptors from \"@babel/runtime-corejs2/core-js/object/get-own-property-descriptors\";\nimport _Object$getOwnPropertyDescriptor from \"@babel/runtime-corejs2/core-js/object/get-own-property-descriptor\";\nimport _Object$getOwnPropertySymbols from \"@babel/runtime-corejs2/core-js/object/get-own-property-symbols\";\nimport _toConsumableArray from \"@babel/runtime-corejs2/helpers/esm/toConsumableArray\";\nimport _Object$keys from \"@babel/runtime-corejs2/core-js/object/keys\";\nimport _Promise from \"@babel/runtime-corejs2/core-js/promise\";\nimport _classCallCheck from \"@babel/runtime-corejs2/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime-corejs2/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"@babel/runtime-corejs2/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime-corejs2/helpers/esm/getPrototypeOf\";\nimport _assertThisInitialized from \"@babel/runtime-corejs2/helpers/esm/assertThisInitialized\";\nimport _inherits from \"@babel/runtime-corejs2/helpers/esm/inherits\";\nimport _defineProperty from \"@babel/runtime-corejs2/helpers/esm/defineProperty\";\nimport React from \"react\";\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = _Object$keys(object); if (_Object$getOwnPropertySymbols) { var symbols = _Object$getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return _Object$getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (_Object$getOwnPropertyDescriptors) { _Object$defineProperties(target, _Object$getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { _Object$defineProperty(target, key, _Object$getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport gql from 'graphql-tag';\nimport { Query, Mutation } from 'react-apollo';\nimport { Card, ResourceList, Stack, TextStyle, ResourceItem, TextField, Thumbnail, DataTable, Button, Checkbox, Icon, Toast, Frame } from '@shopify/polaris';\nimport { StarFilledMinor, StarOutlineMinor } from '@shopify/polaris-icons';\nimport store from 'store-js';\nimport { Redirect } from '@shopify/app-bridge/actions';\nimport { Context } from '@shopify/app-bridge-react';\nimport { useMutation } from '@apollo/react-hooks';\nimport _ from 'lodash';\nimport './ResourceList.css';\nimport { UPDATE_PRODUCTS, SEARCH_PRODUCTS, LIST_PRODUCTS } from \"./graphql.js\";\n\nvar ResourceListWithProducts =\n/*#__PURE__*/\nfunction (_React$Component) {\n  _inherits(ResourceListWithProducts, _React$Component);\n\n  function ResourceListWithProducts() {\n    var _getPrototypeOf2;\n\n    var _this;\n\n    _classCallCheck(this, ResourceListWithProducts);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _possibleConstructorReturn(this, (_getPrototypeOf2 = _getPrototypeOf(ResourceListWithProducts)).call.apply(_getPrototypeOf2, [this].concat(args)));\n\n    _defineProperty(_assertThisInitialized(_this), \"state\", {\n      favorites: {},\n      bundles: {},\n      selectedItems: [],\n      loading: \"\",\n      toasts: []\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"transformData\", function (data, searchquery, replacestring, scopes, matchcase) {\n      var regsearchquery = new RegExp(searchquery, _this.getRegexCase(matchcase));\n      var result = {\n        id: data.id\n      };\n      scopes.map(function (sco) {\n        if (sco === \"tags\") {\n          result[sco] = data[sco].map(function (tag) {\n            return tag.replace(regsearchquery, replacestring);\n          });\n        } else if (sco === \"description\") {\n          result[\"descriptionHtml\"] = data[sco].replace(regsearchquery, replacestring);\n        } else {\n          result[sco] = data[sco].replace(regsearchquery, replacestring);\n        }\n      });\n      console.log(result);\n      return result;\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleReplace\", function (products, searchquery, replacestring, scopes, matchcase) {\n      return new _Promise(function (resolve, reject) {\n        if (!products || products.edges.length < 1) {\n          reject(\"no product\");\n        }\n\n        var promises = products.edges.length;\n        var count = promises;\n        products.edges.map(function (item) {\n          _this.props.apolloClient.mutate({\n            mutation: UPDATE_PRODUCTS,\n            variables: {\n              input: _this.transformData(item.node, searchquery, replacestring, scopes, matchcase)\n            }\n          }).then(function (response) {\n            console.log(response);\n            count -= 1;\n\n            if (count === 0) {\n              resolve({\n                promises: promises,\n                searchquery: searchquery,\n                replacestring: replacestring\n              });\n            }\n          });\n        });\n      });\n    });\n\n    return _this;\n  }\n\n  _createClass(ResourceListWithProducts, [{\n    key: \"randomString\",\n    value: function randomString(length) {\n      return Math.round(Math.pow(36, length + 1) - Math.random() * Math.pow(36, length)).toString(36).slice(1);\n    }\n  }, {\n    key: \"getRegexCase\",\n    value: function getRegexCase(matchcase) {\n      return matchcase ? \"g\" : \"gi\";\n    }\n  }, {\n    key: \"setSelectedItems\",\n    value: function setSelectedItems(selectedItems) {\n      console.log(selectedItems);\n      return this.setState({\n        selectedItems: selectedItems\n      });\n    }\n  }, {\n    key: \"ObjtoArray\",\n    value: function ObjtoArray(obj) {\n      return _Object$keys(obj).map(function (key) {\n        return _objectSpread({}, obj[key], {\n          key: key\n        });\n      });\n    }\n  }, {\n    key: \"ArrayobjtoArray\",\n    value: function ArrayobjtoArray(obj) {\n      return _Object$keys(obj).map(function (key) {\n        return {\n          content: obj[key],\n          key: key\n        };\n      });\n    }\n  }, {\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      this.fetchQuery();\n      var favorites = store.get(\"favorite\") ? store.get(\"favorite\") : {};\n      var bundles = store.get(\"bundle\") ? store.get(\"bundle\") : {}; // if(Object.keys.length(bundles)===0){\n      //     store.set(\"bundle\",{})\n      // }\n\n      console.log(favorites);\n      console.log(bundles);\n      this.setState({\n        favorites: favorites,\n        bundles: bundles\n      });\n    }\n  }, {\n    key: \"fetchQuery\",\n    value: function fetchQuery() {\n      var _this2 = this;\n\n      this.setState({\n        fetching: true\n      });\n      this.props.apolloClient.query({\n        query: LIST_PRODUCTS\n      }).then(function (response) {\n        return _this2.setState({\n          allproducts: response.data.products.edges,\n          fetching: false\n        });\n      });\n    }\n  }, {\n    key: \"filterQuery\",\n    value: function filterQuery(searchquery, scopes, matchcase) {\n      var _this3 = this;\n\n      return new _Promise(function (resolve, reject) {\n        if (searchquery !== \"\" && scopes.length !== 0 && _this3.state.allproducts !== 0) {\n          var currentproducts = _this3.state.allproducts.filter(function (prod) {\n            var regx = new RegExp(searchquery, _this3.getRegexCase(matchcase));\n            return scopes.some(function (sco) {\n              if (sco === \"tags\") {\n                return prod.node[sco].join(\"/n\").search(regx) > -1;\n              }\n\n              return prod.node[sco].search(regx) > -1;\n            });\n          });\n\n          resolve(currentproducts);\n        } else {\n          resolve([]);\n        }\n      });\n    }\n  }, {\n    key: \"runFavorite\",\n    value: function runFavorite(key) {\n      var _this4 = this;\n\n      var _this$state$favorites = this.state.favorites[key],\n          searchquery = _this$state$favorites.searchquery,\n          replacestring = _this$state$favorites.replacestring,\n          scopes = _this$state$favorites.scopes,\n          matchcase = _this$state$favorites.matchcase;\n      this.setState({\n        loading: key\n      });\n      this.filterQuery(searchquery, scopes, matchcase).then(function (response) {\n        console.log(response);\n\n        if (response && response.data && response.data.products && response.data.products.edges.length > 0) {\n          _this4.handleReplace(response.data.products, searchquery, replacestring, scopes, matchcase).then(function (res) {\n            _this4.setState({\n              loading: null,\n              toasts: [].concat(_toConsumableArray(_this4.state.toasts), [{\n                key: _this4.randomString(10),\n                content: \"\".concat(res.promises, \" products changed.\")\n              }])\n            });\n          });\n        } else {\n          _this4.setState({\n            loading: null,\n            toasts: [].concat(_toConsumableArray(_this4.state.toasts), [{\n              key: _this4.randomString(10),\n              content: \"no matching product found\"\n            }])\n          });\n        }\n      });\n    }\n  }, {\n    key: \"removeFavorite\",\n    value: function removeFavorite(key) {\n      var favorites = this.state.favorites;\n      delete favorites[key];\n      store.set(\"favorite\", favorites);\n      this.setState({\n        favorites: favorites\n      });\n    }\n  }, {\n    key: \"createBundle\",\n    value: function createBundle() {\n      var _this$state = this.state,\n          favorites = _this$state.favorites,\n          bundles = _this$state.bundles;\n      var newbundle = this.state.selectedItems.reduce(function (bundle, key) {\n        console.log(bundle);\n        var fav = favorites[key];\n        console.log(fav);\n        delete favorites[key];\n        return [].concat(_toConsumableArray(bundle), [fav]);\n      }, []);\n      var newbundlekey = \"bundle:\" + this.state.selectedItems.join(';');\n      console.log(newbundle);\n      console.log(newbundlekey);\n      console.log(favorites);\n      store.set(\"favorite\", favorites);\n      var newbundles;\n\n      if (!store.get('bundle')) {\n        console.log(\"no current bundle\");\n        newbundles = _defineProperty({}, newbundlekey, newbundle);\n      } else {\n        newbundles = _objectSpread({}, bundles, _defineProperty({}, newbundlekey, newbundle));\n      }\n\n      store.set(\"bundle\", newbundles);\n      this.setState({\n        selectedItems: [],\n        favorites: favorites,\n        bundles: newbundles\n      });\n    }\n  }, {\n    key: \"unbundle\",\n    value: function unbundle(key) {\n      var _this$state2 = this.state,\n          favorites = _this$state2.favorites,\n          bundles = _this$state2.bundles;\n      var bundle = bundles[key];\n      bundle.map(function (fav) {\n        var hashedfav = _Object$keys(fav).sort().map(function (x) {\n          return fav[x].toString();\n        }).join(\";\");\n\n        favorites[hashedfav] = fav;\n      });\n      delete bundles[key];\n      console.log(bundles);\n      console.log(favorites);\n      store.set(\"favorite\", favorites);\n      store.set(\"bundle\", bundles);\n      this.setState({\n        favorites: favorites,\n        bundles: bundles\n      });\n    }\n  }, {\n    key: \"runBundle\",\n    value: function runBundle(key) {\n      var _this5 = this;\n\n      var bundle = this.state.bundles[key];\n      this.setState({\n        loading: key\n      });\n      var bundles = bundle.length;\n      var count = bundles;\n      bundle.map(function (fav) {\n        var searchquery = fav.searchquery,\n            replacestring = fav.replacestring,\n            scopes = fav.scopes,\n            matchcase = fav.matchcase;\n\n        _this5.filterQuery(searchquery, scopes, matchcase).then(function (response) {\n          console.log(response);\n\n          if (response && response.data && response.data.products && response.data.products.edges.length > 0) {\n            _this5.handleReplace(response.data.products, searchquery, replacestring, scopes, matchcase).then(function (res) {\n              _this5.setState({\n                toasts: [].concat(_toConsumableArray(_this5.state.toasts), [{\n                  key: _this5.randomString(10),\n                  content: \"\".concat(res.promises, \" products changed.\")\n                }])\n              }, function () {\n                count -= 1;\n\n                if (count === 0) {\n                  _this5.setState({\n                    loading: null,\n                    toasts: [].concat(_toConsumableArray(_this5.state.toasts), [{\n                      key: _this5.randomString(10),\n                      content: \"bundle completed.\"\n                    }])\n                  });\n                }\n              });\n            });\n          } else {\n            _this5.setState({\n              toasts: [].concat(_toConsumableArray(_this5.state.toasts), [{\n                key: _this5.randomString(10),\n                content: \"no matching product found.\"\n              }])\n            }, function () {\n              count -= 1;\n\n              if (count === 0) {\n                _this5.setState({\n                  loading: null,\n                  toasts: [].concat(_toConsumableArray(_this5.state.toasts), [{\n                    key: _this5.randomString(10),\n                    content: \"bundle completed.\"\n                  }])\n                });\n              }\n            });\n          }\n        });\n      });\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this6 = this;\n\n      var toastMarkup = this.state.toasts.map(function (toast) {\n        return __jsx(Toast, {\n          key: toast.key,\n          content: toast.content,\n          onDismiss: function onDismiss() {\n            return _this6.setState({\n              toasts: _this6.state.toasts.filter(function (to) {\n                return to.key !== toast.key;\n              })\n            });\n          }\n        });\n      });\n      return __jsx(Frame, null, __jsx(Card, null, __jsx(ResourceList, {\n        resourceName: {\n          singular: 'favorite',\n          plural: 'favorites'\n        },\n        items: this.ObjtoArray(this.state.favorites),\n        selectedItems: this.state.selectedItems,\n        onSelectionChange: this.setSelectedItems.bind(this),\n        selectable: true,\n        promotedBulkActions: [{\n          content: 'Bundle',\n          onAction: function onAction() {\n            return _this6.createBundle();\n          }\n        }],\n        renderItem: function renderItem(item) {\n          var key = item.key,\n              searchquery = item.searchquery,\n              replacestring = item.replacestring,\n              matchcase = item.matchcase,\n              scopes = item.scopes;\n          var shortcutActions = [{\n            content: 'Run',\n            loading: _this6.state.loading === key,\n            onAction: function onAction() {\n              return _this6.runFavorite(key);\n            }\n          }, {\n            content: 'Remove',\n            onAction: function onAction() {\n              return _this6.removeFavorite(key);\n            }\n          }];\n          return __jsx(ResourceItem, {\n            id: key,\n            key: key,\n            shortcutActions: shortcutActions,\n            persistActions: true,\n            name: searchquery\n          }, __jsx(\"h3\", null, __jsx(TextStyle, {\n            variation: \"strong\"\n          }, searchquery, \" | \"), __jsx(TextStyle, {\n            variation: \"subdued\"\n          }, \"in (\", scopes.toString(), \")\")), __jsx(\"div\", null, \"Replace with :\\\"\", replacestring, \"\\\" \", matchcase ? \"(Case Sensitive)\" : \"(Case Insensitive)\"));\n        }\n      })), __jsx(Card, null, __jsx(ResourceList, {\n        resourceName: {\n          singular: 'bundle',\n          plural: 'bundles'\n        },\n        items: this.ArrayobjtoArray(this.state.bundles),\n        renderItem: function renderItem(item) {\n          var key = item.key,\n              content = item.content;\n          var shortcutActions = [{\n            content: 'Run',\n            loading: _this6.state.loading === key,\n            onAction: function onAction() {\n              return _this6.runBundle(key);\n            }\n          }, {\n            content: 'Unbundle',\n            onAction: function onAction() {\n              return _this6.unbundle(key);\n            }\n          }];\n          return __jsx(ResourceItem, {\n            id: key,\n            key: key,\n            persistActions: true,\n            shortcutActions: shortcutActions\n          }, __jsx(\"h3\", null, __jsx(TextStyle, {\n            variation: \"strong\"\n          }, \"Bundle\")), content.map(function (item) {\n            return __jsx(\"div\", null, \"Find: \\\"\", item.searchquery, \"\\\" in (\", item.scopes.toString(), \"); Replace with :\\\"\", item.replacestring, \"\\\" \", item.matchcase ? \"(Case Sensitive)\" : \"(Case Insensitive)\");\n          }));\n        }\n      })), this.state.showtoast ? __jsx(Toast, {\n        content: this.state.toastcontent,\n        onDismiss: function onDismiss() {\n          return _this6.setState({\n            showtoast: false\n          });\n        }\n      }) : null, toastMarkup);\n    }\n  }]);\n\n  return ResourceListWithProducts;\n}(React.Component);\n\n_defineProperty(ResourceListWithProducts, \"contextType\", Context);\n\nexport default ResourceListWithProducts;","map":{"version":3,"sources":["/home/edwang09/Documents/Upwork/Shopify/components/FavoriteList.js"],"names":["gql","Query","Mutation","Card","ResourceList","Stack","TextStyle","ResourceItem","TextField","Thumbnail","DataTable","Button","Checkbox","Icon","Toast","Frame","StarFilledMinor","StarOutlineMinor","store","Redirect","Context","useMutation","_","UPDATE_PRODUCTS","SEARCH_PRODUCTS","LIST_PRODUCTS","ResourceListWithProducts","favorites","bundles","selectedItems","loading","toasts","data","searchquery","replacestring","scopes","matchcase","regsearchquery","RegExp","getRegexCase","result","id","map","sco","tag","replace","console","log","products","resolve","reject","edges","length","promises","count","item","props","apolloClient","mutate","mutation","variables","input","transformData","node","then","response","Math","round","pow","random","toString","slice","setState","obj","key","content","fetchQuery","get","fetching","query","allproducts","state","currentproducts","filter","prod","regx","some","join","search","filterQuery","handleReplace","res","randomString","set","newbundle","reduce","bundle","fav","newbundlekey","newbundles","hashedfav","sort","x","toastMarkup","toast","to","singular","plural","ObjtoArray","setSelectedItems","bind","onAction","createBundle","shortcutActions","runFavorite","removeFavorite","ArrayobjtoArray","runBundle","unbundle","showtoast","toastcontent","React","Component"],"mappings":"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","sourcesContent":["import gql from 'graphql-tag';\nimport { Query, Mutation } from 'react-apollo';\nimport { Card,\n    ResourceList,\n    Stack,\n    TextStyle,\n    ResourceItem,\n    TextField,\n    Thumbnail,\n    DataTable,\n    Button,\n    Checkbox,\n    Icon,\n    Toast,\n    Frame\n } from '@shopify/polaris';\n import {\n  StarFilledMinor,\n  StarOutlineMinor\n} from '@shopify/polaris-icons';\nimport store from 'store-js';\nimport { Redirect } from '@shopify/app-bridge/actions';\nimport { Context } from '@shopify/app-bridge-react';\nimport { useMutation } from '@apollo/react-hooks';\nimport _ from 'lodash'\nimport './ResourceList.css'\nimport{ UPDATE_PRODUCTS, SEARCH_PRODUCTS, LIST_PRODUCTS }from \"./graphql.js\"\n\nclass ResourceListWithProducts extends React.Component {\n    static contextType = Context;\n    state = {\n        favorites:{},\n        bundles:{},\n        selectedItems: [],\n        loading: \"\",\n        toasts:[]\n\n    }\n    randomString(length) {\n        return Math.round((Math.pow(36, length + 1) - Math.random() * Math.pow(36, length))).toString(36).slice(1);\n    }\n    getRegexCase(matchcase){return matchcase ? \"g\" : \"gi\"}\n    transformData = (data, searchquery, replacestring, scopes, matchcase)=>{\n        const regsearchquery = new RegExp(searchquery, this.getRegexCase(matchcase));\n        let result = {id:data.id}\n        scopes.map(sco=>{\n            if(sco===\"tags\"){\n                result[sco] = data[sco].map(tag=>tag.replace(regsearchquery, replacestring))\n            }else if(sco===\"description\"){\n                result[\"descriptionHtml\"] = data[sco].replace(regsearchquery, replacestring)\n            }else{\n                result[sco] = data[sco].replace(regsearchquery, replacestring)\n            }\n        })\n        console.log(result)\n        return result\n    }\n    handleReplace = (products, searchquery, replacestring, scopes, matchcase) => {\n        return new Promise((resolve, reject)=>{\n            if(!products || products.edges.length<1){\n                reject(\"no product\") \n            }\n            const promises =products.edges.length\n            let count = promises\n            products.edges.map(item=>{\n                this.props.apolloClient.mutate({\n                    mutation: UPDATE_PRODUCTS,\n                    variables:{input:this.transformData(item.node, searchquery, replacestring, scopes, matchcase)}\n                })\n                .then(response=>{\n                    console.log(response)\n                    count -= 1\n                    if(count === 0){\n                        resolve({promises, searchquery, replacestring})\n                    }\n                })\n            })\n\n        })\n    }\n\n    setSelectedItems(selectedItems){\n        console.log(selectedItems)\n        return this.setState({selectedItems})\n    }\n\n    ObjtoArray(obj){\n        return Object.keys(obj).map((key)=>{\n            return {...obj[key], key}\n        })\n    }\n    ArrayobjtoArray(obj){\n        return Object.keys(obj).map((key)=>{\n            return {content: obj[key], key}\n        })\n    }\n    componentDidMount(){\n        this.fetchQuery()\n        const favorites = store.get(\"favorite\") ? store.get(\"favorite\") : {}\n        const bundles = store.get(\"bundle\") ? store.get(\"bundle\") : {}\n        // if(Object.keys.length(bundles)===0){\n        //     store.set(\"bundle\",{})\n        // }\n        console.log(favorites)\n        console.log(bundles)\n        this.setState({favorites, bundles})\n    }\n    fetchQuery(){\n      this.setState({fetching:true})\n      this.props.apolloClient.query({query: LIST_PRODUCTS}).then(response=>this.setState({allproducts:response.data.products.edges, fetching:false}))\n    }\n    filterQuery(searchquery, scopes, matchcase){\n        return new Promise((resolve, reject)=>{\n            if(searchquery!==\"\" && (scopes.length !== 0) && (this.state.allproducts !== 0) ){\n              const currentproducts = this.state.allproducts.filter(prod=>{\n                const regx = new RegExp(searchquery, this.getRegexCase(matchcase));\n                return scopes.some(sco=>{\n                  if(sco===\"tags\"){\n                    return (prod.node[sco].join(\"/n\").search(regx)>-1)\n                  }\n                  return (prod.node[sco].search(regx)>-1)\n                })\n              })\n              resolve(currentproducts)\n            }else{\n                resolve([])\n            }\n        })\n      }\n    runFavorite(key){\n        const  {searchquery, replacestring, scopes, matchcase} = this.state.favorites[key]\n        this.setState({ loading:key })\n        this.filterQuery(searchquery, scopes, matchcase)\n        .then(response=>{\n            console.log(response)\n            if(response && response.data && response.data.products && response.data.products.edges.length > 0){\n                this.handleReplace(response.data.products,searchquery, replacestring, scopes, matchcase).then((res)=>{\n                    this.setState({ loading:null, toasts: [...this.state.toasts, {key: this.randomString(10), content: `${res.promises} products changed.`}] })\n                })\n            }else{\n                this.setState({ loading:null, toasts: [...this.state.toasts, {key: this.randomString(10), content: `no matching product found`}] })\n            }\n        })\n    }\n    removeFavorite(key){\n        const { favorites } = this.state\n        delete favorites[key]\n        store.set(\"favorite\",favorites)\n        this.setState({favorites})\n    }\n\n    createBundle(){\n        const { favorites, bundles } = this.state\n        const newbundle = this.state.selectedItems.reduce((bundle, key)=>{\n            console.log(bundle)\n            const fav = favorites[key]\n            console.log(fav)\n            delete favorites[key]\n            return [...bundle,fav]\n        },[])\n        const newbundlekey = \"bundle:\"+this.state.selectedItems.join(';')\n        console.log(newbundle)\n        console.log(newbundlekey)\n        console.log(favorites)\n        store.set(\"favorite\",favorites)\n        let newbundles\n        if (!store.get('bundle')){\n            console.log(\"no current bundle\")\n            newbundles = {[newbundlekey]:newbundle}\n        }else{\n            newbundles = {...bundles, [newbundlekey]:newbundle}\n        }\n        store.set(\"bundle\",newbundles)\n        this.setState({selectedItems:[], favorites, bundles: newbundles})\n    }\n    \n    unbundle(key){\n        const { favorites, bundles } = this.state\n        const bundle = bundles[key]\n        bundle.map(fav => {\n            const hashedfav = Object.keys(fav).sort().map(x => fav[x].toString()).join(\";\");\n            favorites[hashedfav] = fav\n        })\n        delete bundles[key]\n        console.log(bundles)\n        console.log(favorites)\n        store.set(\"favorite\",favorites)\n        store.set(\"bundle\",bundles)\n        this.setState({favorites, bundles})\n    }\n\n    runBundle(key){\n        const bundle = this.state.bundles[key]\n        this.setState({loading:key})\n        const bundles = bundle.length\n        let count = bundles\n        bundle.map(fav => {\n            const  {searchquery, replacestring, scopes, matchcase} = fav\n            this.filterQuery(searchquery, scopes, matchcase)\n            .then(response=>{\n                console.log(response)\n                if(response && response.data && response.data.products && response.data.products.edges.length > 0){\n                    this.handleReplace(response.data.products,searchquery, replacestring, scopes, matchcase).then((res)=>{\n                        this.setState({ toasts: [...this.state.toasts, {key: this.randomString(10), content: `${res.promises} products changed.`}] },()=>{\n                            count -= 1\n                            if (count === 0){\n                                this.setState({ loading:null, toasts: [...this.state.toasts, {key: this.randomString(10), content: `bundle completed.`}] })\n                            }\n                        })\n                    })\n                }else{\n                    this.setState({ toasts: [...this.state.toasts, {key: this.randomString(10), content: `no matching product found.`}] },()=>{\n                        count -= 1\n                        if (count === 0){\n                            this.setState({ loading:null, toasts: [...this.state.toasts, {key: this.randomString(10), content: `bundle completed.`}] })\n                        }\n                    })\n                }\n            })\n        })\n    }\n    \n    render() {\n      const toastMarkup = this.state.toasts.map(toast=>{\n          return  (<Toast key = {toast.key} content={toast.content} onDismiss={()=>this.setState({toasts:this.state.toasts.filter(to=>to.key !== toast.key)})}/>)\n      })\n    return (\n        <Frame>\n        <Card>\n        <ResourceList\n            resourceName={{singular: 'favorite', plural: 'favorites'}}\n            items={this.ObjtoArray(this.state.favorites)}\n            selectedItems={this.state.selectedItems}\n            onSelectionChange={this.setSelectedItems.bind(this)}\n            selectable\n            promotedBulkActions={[\n                {\n                  content: 'Bundle',\n                  onAction: ()=>this.createBundle(),\n                }\n            ]}\n            renderItem={(item) => {\n            const {key, searchquery, replacestring, matchcase, scopes} = item;\n            const shortcutActions = [\n                {\n                    content: 'Run',\n                    loading: (this.state.loading === key),\n                    onAction: ()=>this.runFavorite(key),\n                }, {\n                    content: 'Remove',\n                    onAction: ()=>this.removeFavorite(key),\n                }]\n              \n            return (\n                <ResourceItem\n                id={key}\n                key={key}\n                shortcutActions={shortcutActions}\n                persistActions\n                name={searchquery}\n                >\n                <h3>\n                <TextStyle variation=\"strong\">{searchquery} | </TextStyle>\n                <TextStyle variation=\"subdued\">in ({scopes.toString()})</TextStyle>\n                </h3>\n                <div>Replace with :\"{replacestring}\" {matchcase ? \"(Case Sensitive)\" : \"(Case Insensitive)\"}</div>\n                </ResourceItem>\n            );\n            }}\n        />\n        </Card>\n\n        <Card>\n        <ResourceList\n            resourceName={{singular: 'bundle', plural: 'bundles'}}\n            items={this.ArrayobjtoArray(this.state.bundles)}\n            renderItem={(item) => {\n            const {key, content} = item;\n            const shortcutActions = [\n                {\n                    content: 'Run',\n                    loading: (this.state.loading === key),\n                    onAction: ()=>this.runBundle(key),\n                }, {\n                    content: 'Unbundle',\n                    onAction: ()=>this.unbundle(key),\n                }]\n              \n            return (\n                <ResourceItem\n                id={key}\n                key={key}\n                persistActions\n                shortcutActions={shortcutActions}\n                >\n                <h3>\n                    <TextStyle variation=\"strong\">Bundle</TextStyle>\n                </h3>\n                {content.map((item)=>{\n                    return (<div>Find: \"{item.searchquery}\" in ({item.scopes.toString()}); Replace with :\"{item.replacestring}\" {item.matchcase ? \"(Case Sensitive)\" : \"(Case Insensitive)\"}</div>)\n                })}\n                </ResourceItem>\n            );\n            }}\n        />\n        </Card>\n        {this.state.showtoast ? (<Toast content={this.state.toastcontent} onDismiss={() => this.setState({showtoast:false})} />) : null}\n        {toastMarkup}\n        </Frame>\n    );\n  }\n}\n\n export default ResourceListWithProducts;"]},"metadata":{},"sourceType":"module"}