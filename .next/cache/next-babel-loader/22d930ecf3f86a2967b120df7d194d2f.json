{"ast":null,"code":"import _Object$defineProperty from \"@babel/runtime-corejs2/core-js/object/define-property\";\nimport _Object$defineProperties from \"@babel/runtime-corejs2/core-js/object/define-properties\";\nimport _Object$getOwnPropertyDescriptors from \"@babel/runtime-corejs2/core-js/object/get-own-property-descriptors\";\nimport _Object$getOwnPropertyDescriptor from \"@babel/runtime-corejs2/core-js/object/get-own-property-descriptor\";\nimport _Object$getOwnPropertySymbols from \"@babel/runtime-corejs2/core-js/object/get-own-property-symbols\";\nimport _Object$keys from \"@babel/runtime-corejs2/core-js/object/keys\";\nimport _Promise from \"@babel/runtime-corejs2/core-js/promise\";\nimport _toConsumableArray from \"@babel/runtime-corejs2/helpers/esm/toConsumableArray\";\nimport _classCallCheck from \"@babel/runtime-corejs2/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime-corejs2/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"@babel/runtime-corejs2/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime-corejs2/helpers/esm/getPrototypeOf\";\nimport _assertThisInitialized from \"@babel/runtime-corejs2/helpers/esm/assertThisInitialized\";\nimport _inherits from \"@babel/runtime-corejs2/helpers/esm/inherits\";\nimport _defineProperty from \"@babel/runtime-corejs2/helpers/esm/defineProperty\";\nimport React from \"react\";\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = _Object$keys(object); if (_Object$getOwnPropertySymbols) { var symbols = _Object$getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return _Object$getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (_Object$getOwnPropertyDescriptors) { _Object$defineProperties(target, _Object$getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { _Object$defineProperty(target, key, _Object$getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nvar img = 'https://cdn.shopify.com/s/files/1/0757/9955/files/empty-state.svg';\nimport { EmptyState, Layout, Page, Card, ResourceList, TextStyle, ResourceItem, Toast, Frame } from '@shopify/polaris';\nimport store from 'store-js';\nimport { Redirect } from '@shopify/app-bridge/actions';\nimport { Context } from '@shopify/app-bridge-react';\nimport _ from 'lodash';\nimport { UPDATE_PRODUCTS, LIST_PRODUCTS } from \"../components/graphql\";\n\nvar Favorite =\n/*#__PURE__*/\nfunction (_React$Component) {\n  _inherits(Favorite, _React$Component);\n\n  function Favorite() {\n    var _getPrototypeOf2;\n\n    var _this;\n\n    _classCallCheck(this, Favorite);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _possibleConstructorReturn(this, (_getPrototypeOf2 = _getPrototypeOf(Favorite)).call.apply(_getPrototypeOf2, [this].concat(args)));\n\n    _defineProperty(_assertThisInitialized(_this), \"state\", {\n      emptyState: false,\n      favorites: {},\n      bundles: {},\n      selectedItems: [],\n      loading: \"\",\n      toasts: []\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"transformData\", function (data, searchquery, replacestring, scopes, matchcase, operation) {\n      var regsearchquery = new RegExp(searchquery, _this.getRegexCase(matchcase));\n      var result = {\n        id: data.id\n      };\n      scopes.map(function (sco) {\n        if (sco === \"tags\") {\n          if (operation === \"insert\") {\n            result[sco] = [replacestring].concat(_toConsumableArray(data[sco]));\n          } else if (operation === \"append\") {\n            result[sco] = [].concat(_toConsumableArray(data[sco]), [replacestring]);\n          } else {\n            result[sco] = data[sco].map(function (tag) {\n              return tag.replace(regsearchquery, replacestring);\n            });\n          }\n        } else if (sco === \"description\") {\n          if (operation === \"insert\") {\n            result[sco] = \"<p>\".concat(replacestring, \"</p><p>\") + data[sco] + '</p>';\n          } else if (operation === \"append\") {\n            result[sco] = '<p>' + data[sco] + \"</p><p>\".concat(replacestring, \"</p>\");\n          } else {\n            result[\"descriptionHtml\"] = '<p>' + data[sco].replace(regsearchquery, replacestring) + '</p>';\n          }\n        } else {\n          if (operation === \"insert\") {\n            result[sco] = replacestring + data[sco];\n          } else if (operation === \"append\") {\n            result[sco] = data[sco] + replacestring;\n          } else {\n            result[sco] = data[sco].replace(regsearchquery, replacestring);\n          }\n        }\n      });\n      console.log(result);\n      return result;\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleReplace\", function (products, searchquery, replacestring, scopes, matchcase, operation) {\n      return new _Promise(function (resolve, reject) {\n        if (!products || products.length < 1) {\n          reject(\"no product\");\n        }\n\n        var promises = products.length;\n        var count = promises;\n        products.map(function (item) {\n          _this.props.apolloClient.mutate({\n            mutation: UPDATE_PRODUCTS,\n            variables: {\n              input: _this.transformData(item.node, searchquery, replacestring, scopes, matchcase, operation)\n            }\n          }).then(function (response) {\n            console.log(response);\n            count -= 1;\n\n            if (count === 0) {\n              resolve({\n                promises: promises,\n                searchquery: searchquery,\n                replacestring: replacestring\n              });\n            }\n          });\n        });\n      });\n    });\n\n    return _this;\n  }\n\n  _createClass(Favorite, [{\n    key: \"randomString\",\n    value: function randomString(length) {\n      return Math.round(Math.pow(36, length + 1) - Math.random() * Math.pow(36, length)).toString(36).slice(1);\n    }\n  }, {\n    key: \"getRegexCase\",\n    value: function getRegexCase(matchcase) {\n      return matchcase ? \"g\" : \"gi\";\n    }\n  }, {\n    key: \"setSelectedItems\",\n    value: function setSelectedItems(selectedItems) {\n      console.log(selectedItems);\n      return this.setState({\n        selectedItems: selectedItems\n      });\n    }\n  }, {\n    key: \"ObjtoArray\",\n    value: function ObjtoArray(obj) {\n      return _Object$keys(obj).map(function (key) {\n        return _objectSpread({}, obj[key], {\n          key: key\n        });\n      });\n    }\n  }, {\n    key: \"ArrayobjtoArray\",\n    value: function ArrayobjtoArray(obj) {\n      return _Object$keys(obj).map(function (key) {\n        return {\n          content: obj[key],\n          key: key\n        };\n      });\n    }\n  }, {\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var favorites = store.get(\"favorite\") ? store.get(\"favorite\") : {};\n      var bundles = store.get(\"bundle\") ? store.get(\"bundle\") : {};\n      var emptyState = _Object$keys(bundles).length + _Object$keys(favorites).length === 0;\n      this.fetchQuery(); // if(Object.keys.length(bundles)===0){\n      //     store.set(\"bundle\",{})\n      // }\n\n      console.log(favorites);\n      console.log(bundles);\n      this.setState({\n        favorites: favorites,\n        bundles: bundles,\n        emptyState: emptyState\n      });\n    }\n  }, {\n    key: \"fetchQuery\",\n    value: function fetchQuery() {\n      var _this2 = this;\n\n      this.setState({\n        fetching: true\n      });\n      this.props.apolloClient.query({\n        query: LIST_PRODUCTS\n      }).then(function (response) {\n        return _this2.setState({\n          allproducts: response.data.products.edges,\n          fetching: false\n        });\n      });\n    }\n  }, {\n    key: \"filterQuery\",\n    value: function filterQuery(searchquery, scopes, matchcase, operation) {\n      var _this3 = this;\n\n      return new _Promise(function (resolve, reject) {\n        if (operation === \"insert\" || opertaion === \"append\") {\n          return _this3.state.allproducts;\n        } else if (searchquery !== \"\" && scopes.length !== 0 && _this3.state.allproducts.length !== 0) {\n          var currentproducts = _this3.state.allproducts.filter(function (prod) {\n            var regx = new RegExp(searchquery, _this3.getRegexCase(matchcase));\n            return scopes.some(function (sco) {\n              if (sco === \"tags\") {\n                return prod.node[sco].join(\"/n\").search(regx) > -1;\n              }\n\n              return prod.node[sco].search(regx) > -1;\n            });\n          });\n\n          console.log(\"currentproducts\");\n          resolve(currentproducts);\n        } else {\n          resolve([]);\n        }\n      });\n    }\n  }, {\n    key: \"runFavorite\",\n    value: function runFavorite(key) {\n      var _this4 = this;\n\n      var _this$state$favorites = this.state.favorites[key],\n          searchquery = _this$state$favorites.searchquery,\n          replacestring = _this$state$favorites.replacestring,\n          scopes = _this$state$favorites.scopes,\n          matchcase = _this$state$favorites.matchcase,\n          operation = _this$state$favorites.operation;\n      this.setState({\n        loading: key\n      });\n      this.filterQuery(searchquery, scopes, matchcase, operation).then(function (response) {\n        console.log(response);\n\n        if (response && response.length > 0) {\n          _this4.handleReplace(response, searchquery, replacestring, scopes, matchcase, operation).then(function (res) {\n            _this4.setState({\n              loading: null,\n              toasts: [].concat(_toConsumableArray(_this4.state.toasts), [{\n                key: _this4.randomString(10),\n                content: \"\".concat(res.promises, \" products changed.\")\n              }])\n            });\n\n            _this4.fetchQuery();\n          });\n        } else {\n          _this4.setState({\n            loading: null,\n            toasts: [].concat(_toConsumableArray(_this4.state.toasts), [{\n              key: _this4.randomString(10),\n              content: \"no matching product found\"\n            }])\n          });\n        }\n      });\n    }\n  }, {\n    key: \"removeFavorite\",\n    value: function removeFavorite(key) {\n      var favorites = this.state.favorites;\n      delete favorites[key];\n      store.set(\"favorite\", favorites);\n      this.setState({\n        favorites: favorites\n      });\n    }\n  }, {\n    key: \"createBundle\",\n    value: function createBundle() {\n      var _this$state = this.state,\n          favorites = _this$state.favorites,\n          bundles = _this$state.bundles;\n      var newbundle = this.state.selectedItems.reduce(function (bundle, key) {\n        console.log(bundle);\n        var fav = favorites[key];\n        console.log(fav);\n        delete favorites[key];\n        return [].concat(_toConsumableArray(bundle), [fav]);\n      }, []);\n      var newbundlekey = \"bundle:\" + this.state.selectedItems.join(';');\n      console.log(newbundle);\n      console.log(newbundlekey);\n      console.log(favorites);\n      store.set(\"favorite\", favorites);\n      var newbundles;\n\n      if (!store.get('bundle')) {\n        console.log(\"no current bundle\");\n        newbundles = _defineProperty({}, newbundlekey, newbundle);\n      } else {\n        newbundles = _objectSpread({}, bundles, _defineProperty({}, newbundlekey, newbundle));\n      }\n\n      store.set(\"bundle\", newbundles);\n      this.setState({\n        selectedItems: [],\n        favorites: favorites,\n        bundles: newbundles\n      });\n    }\n  }, {\n    key: \"unbundle\",\n    value: function unbundle(key) {\n      var _this$state2 = this.state,\n          favorites = _this$state2.favorites,\n          bundles = _this$state2.bundles;\n      var bundle = bundles[key];\n      bundle.map(function (fav) {\n        var hashedfav = _Object$keys(fav).sort().map(function (x) {\n          return fav[x].toString();\n        }).join(\";\");\n\n        favorites[hashedfav] = fav;\n      });\n      delete bundles[key];\n      console.log(bundles);\n      console.log(favorites);\n      store.set(\"favorite\", favorites);\n      store.set(\"bundle\", bundles);\n      this.setState({\n        favorites: favorites,\n        bundles: bundles\n      });\n    }\n  }, {\n    key: \"runBundle\",\n    value: function runBundle(key) {\n      var _this5 = this;\n\n      var bundle = this.state.bundles[key];\n      this.setState({\n        loading: key\n      });\n      var bundles = bundle.length;\n      var count = bundles;\n      bundle.map(function (fav) {\n        var searchquery = fav.searchquery,\n            replacestring = fav.replacestring,\n            scopes = fav.scopes,\n            matchcase = fav.matchcase,\n            operation = fav.operation;\n\n        _this5.filterQuery(searchquery, scopes, matchcase, operation).then(function (response) {\n          console.log(response);\n\n          if (response && response.length > 0) {\n            _this5.handleReplace(response, searchquery, replacestring, scopes, matchcase, operation).then(function (res) {\n              _this5.setState({\n                toasts: [].concat(_toConsumableArray(_this5.state.toasts), [{\n                  key: _this5.randomString(10),\n                  content: \"\".concat(res.promises, \" products changed.\")\n                }])\n              }, function () {\n                count -= 1;\n\n                if (count === 0) {\n                  _this5.setState({\n                    loading: null,\n                    toasts: [].concat(_toConsumableArray(_this5.state.toasts), [{\n                      key: _this5.randomString(10),\n                      content: \"bundle completed.\"\n                    }])\n                  });\n\n                  _this5.fetchQuery();\n                }\n              });\n            });\n          } else {\n            _this5.setState({\n              toasts: [].concat(_toConsumableArray(_this5.state.toasts), [{\n                key: _this5.randomString(10),\n                content: \"no matching product found.\"\n              }])\n            }, function () {\n              count -= 1;\n\n              if (count === 0) {\n                _this5.setState({\n                  loading: null,\n                  toasts: [].concat(_toConsumableArray(_this5.state.toasts), [{\n                    key: _this5.randomString(10),\n                    content: \"bundle completed.\"\n                  }])\n                });\n\n                _this5.fetchQuery();\n              }\n            });\n          }\n        });\n      });\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this6 = this;\n\n      var toastMarkup = this.state.toasts.map(function (toast) {\n        return __jsx(Toast, {\n          key: toast.key,\n          content: toast.content,\n          onDismiss: function onDismiss() {\n            return _this6.setState({\n              toasts: _this6.state.toasts.filter(function (to) {\n                return to.key !== toast.key;\n              })\n            });\n          }\n        });\n      });\n      return __jsx(Page, null, this.state.emptyState ? __jsx(Layout, null, __jsx(EmptyState, {\n        heading: \"You dont have favorite yet\",\n        action: {\n          content: 'Go to main page',\n          onAction: function onAction() {\n            return _this6.setState({\n              open: true\n            });\n          }\n        },\n        image: img\n      }, __jsx(\"p\", null, \"Create Find and Replace and save it to favorite\"))) : __jsx(Frame, null, __jsx(Card, null, __jsx(ResourceList, {\n        resourceName: {\n          singular: 'favorite',\n          plural: 'favorites'\n        },\n        items: this.ObjtoArray(this.state.favorites),\n        selectedItems: this.state.selectedItems,\n        onSelectionChange: this.setSelectedItems.bind(this),\n        selectable: true,\n        promotedBulkActions: [{\n          content: 'Bundle',\n          onAction: function onAction() {\n            return _this6.createBundle();\n          }\n        }],\n        renderItem: function renderItem(item) {\n          var key = item.key,\n              searchquery = item.searchquery,\n              replacestring = item.replacestring,\n              matchcase = item.matchcase,\n              scopes = item.scopes,\n              operation = item.operation;\n          var shortcutActions = [{\n            content: 'Run',\n            loading: _this6.state.loading === key,\n            onAction: function onAction() {\n              return _this6.runFavorite(key);\n            }\n          }, {\n            content: 'Remove',\n            onAction: function onAction() {\n              return _this6.removeFavorite(key);\n            }\n          }];\n          var title = {\n            \"find\": \"Find \\\"\".concat(searchquery, \"\\\"\"),\n            \"insert\": \"Insert in front\",\n            \"append\": \"Append to end\"\n          };\n          return __jsx(ResourceItem, {\n            id: key,\n            key: key,\n            shortcutActions: shortcutActions,\n            persistActions: true,\n            name: searchquery\n          }, __jsx(\"h3\", null, __jsx(TextStyle, {\n            variation: \"strong\"\n          }, title[operation], \" | \"), __jsx(TextStyle, {\n            variation: \"subdued\"\n          }, \"in (\", scopes.toString(), \")\")), __jsx(\"div\", null, searchquery === 'find' ? \"Replace\" : \"\", \" with :\\\"\", replacestring, \"\\\" \", matchcase ? \"(Case Sensitive)\" : \"(Case Insensitive)\"));\n        }\n      })), __jsx(Card, null, __jsx(ResourceList, {\n        resourceName: {\n          singular: 'bundle',\n          plural: 'bundles'\n        },\n        items: this.ArrayobjtoArray(this.state.bundles),\n        renderItem: function renderItem(item) {\n          var key = item.key,\n              content = item.content;\n          var shortcutActions = [{\n            content: 'Run',\n            loading: _this6.state.loading === key,\n            onAction: function onAction() {\n              return _this6.runBundle(key);\n            }\n          }, {\n            content: 'Unbundle',\n            onAction: function onAction() {\n              return _this6.unbundle(key);\n            }\n          }];\n          return __jsx(ResourceItem, {\n            id: key,\n            key: key,\n            persistActions: true,\n            shortcutActions: shortcutActions\n          }, __jsx(\"h3\", null, __jsx(TextStyle, {\n            variation: \"strong\"\n          }, \"Bundle\")), content.map(function (item) {\n            var title = {\n              \"find\": \"Find \\\"\".concat(item.searchquery, \"\\\"\"),\n              \"insert\": \"Insert in front\",\n              \"append\": \"Append to end\"\n            };\n            return __jsx(\"div\", null, title[item.operation], \" in (\", item.scopes.toString(), \"); \", item.searchquery === 'find' ? \"Replace\" : \"\", \" with :\\\"\", item.replacestring, \"\\\" \", item.matchcase ? \"(Case Sensitive)\" : \"(Case Insensitive)\");\n          }));\n        }\n      })), this.state.showtoast ? __jsx(Toast, {\n        content: this.state.toastcontent,\n        onDismiss: function onDismiss() {\n          return _this6.setState({\n            showtoast: false\n          });\n        }\n      }) : null, toastMarkup));\n    }\n  }]);\n\n  return Favorite;\n}(React.Component);\n\n_defineProperty(Favorite, \"contextType\", Context);\n\nexport default Favorite;","map":{"version":3,"sources":["/home/edwang09/Documents/Upwork/Shopify/pages/favorite.js"],"names":["img","EmptyState","Layout","Page","Card","ResourceList","TextStyle","ResourceItem","Toast","Frame","store","Redirect","Context","_","UPDATE_PRODUCTS","LIST_PRODUCTS","Favorite","emptyState","favorites","bundles","selectedItems","loading","toasts","data","searchquery","replacestring","scopes","matchcase","operation","regsearchquery","RegExp","getRegexCase","result","id","map","sco","tag","replace","console","log","products","resolve","reject","length","promises","count","item","props","apolloClient","mutate","mutation","variables","input","transformData","node","then","response","Math","round","pow","random","toString","slice","setState","obj","key","content","get","fetchQuery","fetching","query","allproducts","edges","opertaion","state","currentproducts","filter","prod","regx","some","join","search","filterQuery","handleReplace","res","randomString","set","newbundle","reduce","bundle","fav","newbundlekey","newbundles","hashedfav","sort","x","toastMarkup","toast","to","onAction","open","singular","plural","ObjtoArray","setSelectedItems","bind","createBundle","shortcutActions","runFavorite","removeFavorite","title","ArrayobjtoArray","runBundle","unbundle","showtoast","toastcontent","React","Component"],"mappings":"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","sourcesContent":["const img = 'https://cdn.shopify.com/s/files/1/0757/9955/files/empty-state.svg';\nimport { EmptyState, Layout, Page, Card, \n    ResourceList,\n    TextStyle,\n    ResourceItem,\n    Toast,\n    Frame\n } from '@shopify/polaris';\nimport store from 'store-js';\nimport { Redirect } from '@shopify/app-bridge/actions';\nimport { Context } from '@shopify/app-bridge-react';\nimport _ from 'lodash'\nimport{ UPDATE_PRODUCTS, LIST_PRODUCTS }from \"../components/graphql\"\n\nclass Favorite extends React.Component {\n    static contextType = Context;\n    state = {\n        emptyState:false,\n        favorites:{},\n        bundles:{},\n        selectedItems: [],\n        loading: \"\",\n        toasts:[]\n\n    }\n    randomString(length) {\n        return Math.round((Math.pow(36, length + 1) - Math.random() * Math.pow(36, length))).toString(36).slice(1);\n    }\n    getRegexCase(matchcase){return matchcase ? \"g\" : \"gi\"}\n    transformData = (data, searchquery, replacestring, scopes, matchcase, operation)=>{\n        const regsearchquery = new RegExp(searchquery, this.getRegexCase(matchcase));\n        let result = {id:data.id}\n        scopes.map(sco=>{\n            if(sco===\"tags\"){\n                if (operation === \"insert\"){\n                  result[sco] = [ replacestring, ...data[sco]]\n                }else if (operation === \"append\"){\n                  result[sco] = [...data[sco], replacestring]\n                }else{\n                  result[sco] = data[sco].map(tag=>tag.replace(regsearchquery, replacestring))\n                }\n              }else if(sco===\"description\"){\n                if (operation === \"insert\"){\n                  result[sco] = `<p>${replacestring}</p><p>` + data[sco] + '</p>'\n                }else if (operation === \"append\"){\n                  result[sco] = '<p>' + data[sco] + `</p><p>${replacestring}</p>`\n                }else{\n                  result[\"descriptionHtml\"] = '<p>' + data[sco].replace(regsearchquery, replacestring) + '</p>'\n                }\n              }else{\n                if (operation === \"insert\"){\n                  result[sco] = replacestring + data[sco]\n                }else if (operation === \"append\"){\n                  result[sco] = data[sco] + replacestring\n                }else{\n                  result[sco] = data[sco].replace(regsearchquery, replacestring)\n                }\n            }\n        })\n        console.log(result)\n        return result\n    }\n    handleReplace = (products, searchquery, replacestring, scopes, matchcase, operation) => {\n        return new Promise((resolve, reject)=>{\n            if(!products || products.length<1){\n                reject(\"no product\") \n            }\n            const promises =products.length\n            let count = promises\n            products.map(item=>{\n                this.props.apolloClient.mutate({\n                    mutation: UPDATE_PRODUCTS,\n                    variables:{input:this.transformData(item.node, searchquery, replacestring, scopes, matchcase, operation)}\n                })\n                .then(response=>{\n                    console.log(response)\n                    count -= 1\n                    if(count === 0){\n                        resolve({promises, searchquery, replacestring})\n                    }\n                })\n            })\n\n        })\n    }\n\n    setSelectedItems(selectedItems){\n        console.log(selectedItems)\n        return this.setState({selectedItems})\n    }\n\n    ObjtoArray(obj){\n        return Object.keys(obj).map((key)=>{\n            return {...obj[key], key}\n        })\n    }\n    ArrayobjtoArray(obj){\n        return Object.keys(obj).map((key)=>{\n            return {content: obj[key], key}\n        })\n    }\n    componentDidMount(){\n      const favorites = store.get(\"favorite\") ? store.get(\"favorite\") : {}\n      const bundles = store.get(\"bundle\") ? store.get(\"bundle\") : {}\n      const emptyState = (Object.keys(bundles).length + Object.keys(favorites).length) === 0\n      this.fetchQuery()\n        // if(Object.keys.length(bundles)===0){\n        //     store.set(\"bundle\",{})\n        // }\n        console.log(favorites)\n        console.log(bundles)\n        this.setState({favorites, bundles, emptyState})\n    }\n    fetchQuery(){\n      this.setState({fetching:true})\n      this.props.apolloClient.query({query: LIST_PRODUCTS}).then(response=>this.setState({allproducts:response.data.products.edges, fetching:false}))\n    }\n    filterQuery(searchquery, scopes, matchcase, operation){\n        return new Promise((resolve, reject)=>{\n            if(operation===\"insert\" || opertaion ===\"append\"){\n                return this.state.allproducts\n            }else if(searchquery!==\"\" && (scopes.length !== 0) && (this.state.allproducts.length !== 0) ){\n              const currentproducts = this.state.allproducts.filter(prod=>{\n                const regx = new RegExp(searchquery, this.getRegexCase(matchcase));\n                return scopes.some(sco=>{\n                  if(sco===\"tags\"){\n                    return (prod.node[sco].join(\"/n\").search(regx)>-1)\n                  }\n                  return (prod.node[sco].search(regx)>-1)\n                })\n              })\n              console.log(\"currentproducts\")\n              resolve(currentproducts)\n            }else{\n                resolve([])\n            }\n        })\n      }\n    runFavorite(key){\n        const  {searchquery, replacestring, scopes, matchcase, operation} = this.state.favorites[key]\n        this.setState({ loading:key })\n        this.filterQuery(searchquery, scopes, matchcase, operation)\n        .then(response=>{\n            console.log(response)\n            if(response && response.length > 0){\n                this.handleReplace(response ,searchquery, replacestring, scopes, matchcase, operation).then((res)=>{\n                    this.setState({ loading:null, toasts: [...this.state.toasts, {key: this.randomString(10), content: `${res.promises} products changed.`}] })\n                    this.fetchQuery()\n                })\n            }else{\n                this.setState({ loading:null, toasts: [...this.state.toasts, {key: this.randomString(10), content: `no matching product found`}] })\n            }\n        })\n    }\n    removeFavorite(key){\n        const { favorites } = this.state\n        delete favorites[key]\n        store.set(\"favorite\",favorites)\n        this.setState({favorites})\n    }\n\n    createBundle(){\n        const { favorites, bundles } = this.state\n        const newbundle = this.state.selectedItems.reduce((bundle, key)=>{\n            console.log(bundle)\n            const fav = favorites[key]\n            console.log(fav)\n            delete favorites[key]\n            return [...bundle,fav]\n        },[])\n        const newbundlekey = \"bundle:\"+this.state.selectedItems.join(';')\n        console.log(newbundle)\n        console.log(newbundlekey)\n        console.log(favorites)\n        store.set(\"favorite\",favorites)\n        let newbundles\n        if (!store.get('bundle')){\n            console.log(\"no current bundle\")\n            newbundles = {[newbundlekey]:newbundle}\n        }else{\n            newbundles = {...bundles, [newbundlekey]:newbundle}\n        }\n        store.set(\"bundle\",newbundles)\n        this.setState({selectedItems:[], favorites, bundles: newbundles})\n    }\n    \n    unbundle(key){\n        const { favorites, bundles } = this.state\n        const bundle = bundles[key]\n        bundle.map(fav => {\n            const hashedfav = Object.keys(fav).sort().map(x => fav[x].toString()).join(\";\");\n            favorites[hashedfav] = fav\n        })\n        delete bundles[key]\n        console.log(bundles)\n        console.log(favorites)\n        store.set(\"favorite\",favorites)\n        store.set(\"bundle\",bundles)\n        this.setState({favorites, bundles})\n    }\n\n    runBundle(key){\n        const bundle = this.state.bundles[key]\n        this.setState({loading:key})\n        const bundles = bundle.length\n        let count = bundles\n        bundle.map(fav => {\n            const  {searchquery, replacestring, scopes, matchcase, operation} = fav\n            this.filterQuery(searchquery, scopes, matchcase, operation)\n            .then(response=>{\n                console.log(response)\n                if(response && response.length > 0){\n                    this.handleReplace(response ,searchquery, replacestring, scopes, matchcase, operation).then((res)=>{\n                        this.setState({ toasts: [...this.state.toasts, {key: this.randomString(10), content: `${res.promises} products changed.`}] },()=>{\n                            count -= 1\n                            if (count === 0){\n                                this.setState({ loading:null, toasts: [...this.state.toasts, {key: this.randomString(10), content: `bundle completed.`}] })\n                                this.fetchQuery()\n                            }\n                        })\n                    })\n                }else{\n                    this.setState({ toasts: [...this.state.toasts, {key: this.randomString(10), content: `no matching product found.`}] },()=>{\n                        count -= 1\n                        if (count === 0){\n                            this.setState({ loading:null, toasts: [...this.state.toasts, {key: this.randomString(10), content: `bundle completed.`}] })\n                            this.fetchQuery()\n                        }\n                    })\n                }\n            })\n        })\n    }\n    \n    render() {\n      \n      const toastMarkup = this.state.toasts.map(toast=>{\n          return  (<Toast key = {toast.key} content={toast.content} onDismiss={()=>this.setState({toasts:this.state.toasts.filter(to=>to.key !== toast.key)})}/>)\n      })\n    return (\n      <Page>\n      { this.state.emptyState ? (\n        <Layout>\n          <EmptyState\n            heading=\"You dont have favorite yet\"\n            action={{\n              content: 'Go to main page',\n              onAction: () => this.setState({ open: true }),\n            }}\n            image={img}\n          >\n            <p>Create Find and Replace and save it to favorite</p>\n          </EmptyState>\n        </Layout>\n      ) : (\n        <Frame>\n        <Card>\n        <ResourceList\n            resourceName={{singular: 'favorite', plural: 'favorites'}}\n            items={this.ObjtoArray(this.state.favorites)}\n            selectedItems={this.state.selectedItems}\n            onSelectionChange={this.setSelectedItems.bind(this)}\n            selectable\n            promotedBulkActions={[\n                {\n                  content: 'Bundle',\n                  onAction: ()=>this.createBundle(),\n                }\n            ]}\n            renderItem={(item) => {\n            const {key, searchquery, replacestring, matchcase, scopes,operation} = item;\n            const shortcutActions = [\n                {\n                    content: 'Run',\n                    loading: (this.state.loading === key),\n                    onAction: ()=>this.runFavorite(key),\n                }, {\n                    content: 'Remove',\n                    onAction: ()=>this.removeFavorite(key),\n                }]\n            const title = {\n                \"find\": `Find \"${searchquery}\"`,\n                \"insert\": \"Insert in front\",\n                \"append\": \"Append to end\"\n                }\n            return (\n                <ResourceItem\n                id={key}\n                key={key}\n                shortcutActions={shortcutActions}\n                persistActions\n                name={searchquery}\n                >\n                <h3>\n                <TextStyle variation=\"strong\">{title[operation]} | </TextStyle>\n                <TextStyle variation=\"subdued\">in ({scopes.toString()})</TextStyle>\n                </h3>\n                <div>{searchquery==='find' ? \"Replace\" : \"\" } with :\"{replacestring}\" {matchcase ? \"(Case Sensitive)\" : \"(Case Insensitive)\"}</div>\n                </ResourceItem>\n            );\n            }}\n        />\n        </Card>\n\n        <Card>\n        <ResourceList\n            resourceName={{singular: 'bundle', plural: 'bundles'}}\n            items={this.ArrayobjtoArray(this.state.bundles)}\n            renderItem={(item) => {\n            const {key, content} = item;\n            const shortcutActions = [\n                {\n                    content: 'Run',\n                    loading: (this.state.loading === key),\n                    onAction: ()=>this.runBundle(key),\n                }, {\n                    content: 'Unbundle',\n                    onAction: ()=>this.unbundle(key),\n                }]\n              \n            return (\n                <ResourceItem\n                id={key}\n                key={key}\n                persistActions\n                shortcutActions={shortcutActions}\n                >\n                <h3>\n                    <TextStyle variation=\"strong\">Bundle</TextStyle>\n                </h3>\n                {content.map((item)=>{\n                    const title = {\n                        \"find\": `Find \"${item.searchquery}\"`,\n                        \"insert\": \"Insert in front\",\n                        \"append\": \"Append to end\"\n                    }\n                    return (<div>{title[item.operation]} in ({item.scopes.toString()}); {item.searchquery==='find' ? \"Replace\" : \"\" } with :\"{item.replacestring}\" {item.matchcase ? \"(Case Sensitive)\" : \"(Case Insensitive)\"}</div>)\n                })}\n                </ResourceItem>\n            );\n            }}\n        />\n        </Card>\n        {this.state.showtoast ? (<Toast content={this.state.toastcontent} onDismiss={() => this.setState({showtoast:false})} />) : null}\n        {toastMarkup}\n        </Frame>\n        )}\n    </Page>\n    );\n  }\n}\n\n export default Favorite;"]},"metadata":{},"sourceType":"module"}