{"ast":null,"code":"import _Object$defineProperty from \"@babel/runtime-corejs2/core-js/object/define-property\";\nimport _Object$defineProperties from \"@babel/runtime-corejs2/core-js/object/define-properties\";\nimport _Object$getOwnPropertyDescriptors from \"@babel/runtime-corejs2/core-js/object/get-own-property-descriptors\";\nimport _Object$getOwnPropertyDescriptor from \"@babel/runtime-corejs2/core-js/object/get-own-property-descriptor\";\nimport _Object$getOwnPropertySymbols from \"@babel/runtime-corejs2/core-js/object/get-own-property-symbols\";\nimport _Object$keys from \"@babel/runtime-corejs2/core-js/object/keys\";\nimport _classCallCheck from \"@babel/runtime-corejs2/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime-corejs2/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"@babel/runtime-corejs2/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime-corejs2/helpers/esm/getPrototypeOf\";\nimport _assertThisInitialized from \"@babel/runtime-corejs2/helpers/esm/assertThisInitialized\";\nimport _inherits from \"@babel/runtime-corejs2/helpers/esm/inherits\";\nimport _defineProperty from \"@babel/runtime-corejs2/helpers/esm/defineProperty\";\nimport React from \"react\";\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = _Object$keys(object); if (_Object$getOwnPropertySymbols) { var symbols = _Object$getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return _Object$getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (_Object$getOwnPropertyDescriptors) { _Object$defineProperties(target, _Object$getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { _Object$defineProperty(target, key, _Object$getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport gql from 'graphql-tag';\nimport { Query, Mutation } from 'react-apollo';\nimport { Card, ResourceList, Stack, TextStyle, ResourceItem, TextField, Thumbnail, DataTable, Button, Checkbox, Icon } from '@shopify/polaris';\nimport { StarFilledMinor, StarOutlineMinor } from '@shopify/polaris-icons';\nimport store from 'store-js';\nimport { Redirect } from '@shopify/app-bridge/actions';\nimport { Context } from '@shopify/app-bridge-react';\nimport { useMutation } from '@apollo/react-hooks';\nimport _ from 'lodash';\nimport './ResourceList.css';\nimport { UPDATE_PRODUCTS, SEARCH_PRODUCTS } from \"./graphql.js\";\n\nvar ResourceListWithProducts =\n/*#__PURE__*/\nfunction (_React$Component) {\n  _inherits(ResourceListWithProducts, _React$Component);\n\n  function ResourceListWithProducts() {\n    var _getPrototypeOf2;\n\n    var _this;\n\n    _classCallCheck(this, ResourceListWithProducts);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _possibleConstructorReturn(this, (_getPrototypeOf2 = _getPrototypeOf(ResourceListWithProducts)).call.apply(_getPrototypeOf2, [this].concat(args)));\n\n    _defineProperty(_assertThisInitialized(_this), \"state\", {\n      favorites: [],\n      selectedItems: []\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"transformData\", function (data, searchquery, replacestring) {\n      var regexsearchquery = new RegExp(searchquery, \"gi\");\n      var result = {\n        id: data.id,\n        title: data.title.replace(regexsearchquery, replacestring),\n        handle: data.handle.replace(regexsearchquery, replacestring),\n        descriptionHtml: \"<p>\".concat(data.description.replace(regexsearchquery, replacestring), \"</p>\")\n      };\n      return result;\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleReplace\", function (products, searchquery, replacestring) {\n      if (!products || products.length < 1) {\n        return;\n      }\n\n      products.edges.map(function (item) {\n        _this.props.apolloClient.mutate({\n          mutation: UPDATE_PRODUCTS,\n          variables: {\n            input: _this.transformData(item.node, searchquery, replacestring)\n          }\n        }).then(function (response) {\n          console.log(response);\n        });\n      });\n    });\n\n    return _this;\n  }\n\n  _createClass(ResourceListWithProducts, [{\n    key: \"setSelectedItems\",\n    value: function setSelectedItems(selectedItems) {\n      console.log(selectedItems);\n      return this.setState({\n        selectedItems: selectedItems\n      });\n    }\n  }, {\n    key: \"ObjtoArray\",\n    value: function ObjtoArray(favorite) {\n      return _Object$keys(favorite).map(function (key) {\n        return _objectSpread({}, favorite[key], {\n          key: key\n        });\n      });\n    }\n  }, {\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var favorites = store.get(\"favorite\") ? store.get(\"favorite\") : {};\n      var bundles = store.get(\"bundle\") ? store.get(\"bundle\") : {};\n      store.set(\"bundle\", {});\n      console.log(favorites);\n      console.log(bundles);\n      this.setState({\n        favorites: favorites,\n        bundles: bundles\n      });\n    }\n  }, {\n    key: \"runFavorite\",\n    value: function runFavorite(key) {\n      var _this2 = this;\n\n      var _this$state$favorites = this.state.favorites[key],\n          searchquery = _this$state$favorites.searchquery,\n          replacestring = _this$state$favorites.replacestring;\n      this.props.apolloClient.query({\n        query: SEARCH_PRODUCTS,\n        variables: {\n          searchquery: searchquery\n        }\n      }).then(function (response) {\n        if (response && response.data && response.data.products) {\n          _this2.handleReplace(response.data.products, searchquery, replacestring);\n        } else {\n          console.log(\"no item found\");\n        }\n      });\n    }\n  }, {\n    key: \"removeFavorite\",\n    value: function removeFavorite(key) {\n      var favorites = this.state.favorites;\n      delete favorites[key];\n      store.set(\"favorite\", favorites);\n      this.setState({\n        favorites: favorites\n      });\n    }\n  }, {\n    key: \"createBundle\",\n    value: function createBundle() {\n      var _this$state = this.state,\n          favorites = _this$state.favorites,\n          bundles = _this$state.bundles;\n      var newbundle = this.state.selectedItems.reduce(function (bundle, key) {\n        bundle = bundle.push(favorites[key]);\n        delete favorites[key];\n      }, []);\n      var newbundlekey = \"bundle:\" + this.state.selectedItems.join(';');\n      console.log(newbundle);\n      console.log(newbundlekey);\n      console.log(favorites);\n      store.set(\"favorite\", favorites);\n\n      if (!store.get('bundle')) {\n        console.log(\"no current bundle\");\n        store.set(\"bundle\", _defineProperty({}, newbundlekey, newbundle));\n      } else {\n        store.set(\"bundle\", _objectSpread({}, bundles, _defineProperty({}, newbundlekey, newbundle)));\n      }\n\n      this.setState({\n        selectedItems: []\n      });\n    }\n  }, {\n    key: \"unbundle\",\n    value: function unbundle(key) {\n      var _this$state2 = this.state,\n          favorites = _this$state2.favorites,\n          bundles = _this$state2.bundles;\n      var bundle = bundles[key];\n      bundle.map(function (fav) {\n        var hashedfav = _Object$keys(fav).sort().map(function (x) {\n          return fav[x].toString();\n        }).join(\";\");\n\n        favorites[hashedfav] = fav;\n      });\n      delete bundles[key];\n      console.log(bundles);\n      console.log(favorites);\n      store.set(\"favorite\", favorites);\n      store.set(\"bundle\", bundles);\n      this.setState({\n        favorites: favorites,\n        bundles: bundles\n      });\n    }\n  }, {\n    key: \"runBundle\",\n    value: function runBundle(key) {\n      var _this3 = this;\n\n      var bundle = this.state.bundles[key];\n      bundle.map(function (fav) {\n        var searchquery = fav.searchquery,\n            replacestring = fav.replacestring;\n\n        _this3.props.apolloClient.query({\n          query: SEARCH_PRODUCTS,\n          variables: {\n            searchquery: searchquery\n          }\n        }).then(function (response) {\n          if (response && response.data && response.data.products) {\n            _this3.handleReplace(response.data.products, searchquery, replacestring);\n          } else {\n            console.log(\"no item found\");\n          }\n        });\n      });\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this4 = this;\n\n      var app = this.context;\n\n      var redirectToProduct = function redirectToProduct() {\n        var redirect = Redirect.create(app);\n        redirect.dispatch(Redirect.Action.APP, '/edit-products');\n      };\n\n      return __jsx(\"div\", null, __jsx(Card, null, __jsx(ResourceList, {\n        resourceName: {\n          singular: 'favorite',\n          plural: 'favorites'\n        },\n        items: this.ObjtoArray(this.state.favorites),\n        selectedItems: this.state.selectedItems,\n        onSelectionChange: this.setSelectedItems.bind(this),\n        selectable: true,\n        promotedBulkActions: [{\n          content: 'Bundle',\n          onAction: function onAction() {\n            return _this4.createBundle();\n          }\n        }],\n        renderItem: function renderItem(item) {\n          var key = item.key,\n              searchquery = item.searchquery,\n              replacestring = item.replacestring,\n              matchcase = item.matchcase;\n          var shortcutActions = [{\n            content: 'Run',\n            onAction: function onAction() {\n              return _this4.runFavorite(key);\n            }\n          }, {\n            content: 'Remove',\n            onAction: function onAction() {\n              return _this4.removeFavorite(key);\n            }\n          }];\n          return __jsx(ResourceItem, {\n            id: key,\n            url: \"url\",\n            shortcutActions: shortcutActions,\n            name: searchquery\n          }, __jsx(\"h3\", null, __jsx(TextStyle, {\n            variation: \"strong\"\n          }, searchquery)), __jsx(\"div\", null, \"Replace with :\\\"\", replacestring, \"\\\" \", matchcase ? \"(Case Sensitive)\" : \"(Case Insensitive)\"));\n        }\n      })));\n    }\n  }]);\n\n  return ResourceListWithProducts;\n}(React.Component);\n\n_defineProperty(ResourceListWithProducts, \"contextType\", Context);\n\nexport default ResourceListWithProducts;","map":{"version":3,"sources":["/home/edwang09/Documents/Upwork/Shopify/components/FavoriteList.js"],"names":["gql","Query","Mutation","Card","ResourceList","Stack","TextStyle","ResourceItem","TextField","Thumbnail","DataTable","Button","Checkbox","Icon","StarFilledMinor","StarOutlineMinor","store","Redirect","Context","useMutation","_","UPDATE_PRODUCTS","SEARCH_PRODUCTS","ResourceListWithProducts","favorites","selectedItems","data","searchquery","replacestring","regexsearchquery","RegExp","result","id","title","replace","handle","descriptionHtml","description","products","length","edges","map","item","props","apolloClient","mutate","mutation","variables","input","transformData","node","then","response","console","log","setState","favorite","key","get","bundles","set","state","query","handleReplace","newbundle","reduce","bundle","push","newbundlekey","join","fav","hashedfav","sort","x","toString","app","context","redirectToProduct","redirect","create","dispatch","Action","APP","singular","plural","ObjtoArray","setSelectedItems","bind","content","onAction","createBundle","matchcase","shortcutActions","runFavorite","removeFavorite","React","Component"],"mappings":";;;;;;;;;;;;;;;;;;;;AAAA,OAAOA,GAAP,MAAgB,aAAhB;AACA,SAASC,KAAT,EAAgBC,QAAhB,QAAgC,cAAhC;AACA,SAASC,IAAT,EACIC,YADJ,EAEIC,KAFJ,EAGIC,SAHJ,EAIIC,YAJJ,EAKIC,SALJ,EAMIC,SANJ,EAOIC,SAPJ,EAQIC,MARJ,EASIC,QATJ,EAUIC,IAVJ,QAWQ,kBAXR;AAYC,SACCC,eADD,EAECC,gBAFD,QAGM,wBAHN;AAID,OAAOC,KAAP,MAAkB,UAAlB;AACA,SAASC,QAAT,QAAyB,6BAAzB;AACA,SAASC,OAAT,QAAwB,2BAAxB;AACA,SAASC,WAAT,QAA4B,qBAA5B;AACA,OAAOC,CAAP,MAAc,QAAd;AACA,OAAO,oBAAP;AACA,SAAQC,eAAR,EAAyBC,eAAzB,QAA+C,cAA/C;;IAEMC,wB;;;;;;;;;;;;;;;;;;4DAEM;AACJC,MAAAA,SAAS,EAAC,EADN;AAEJC,MAAAA,aAAa,EAAE;AAFX,K;;oEAKQ,UAACC,IAAD,EAAOC,WAAP,EAAoBC,aAApB,EAAoC;AAChD,UAAMC,gBAAgB,GAAG,IAAIC,MAAJ,CAAWH,WAAX,EAAwB,IAAxB,CAAzB;AACA,UAAMI,MAAM,GAAG;AACXC,QAAAA,EAAE,EAACN,IAAI,CAACM,EADG;AAEXC,QAAAA,KAAK,EAAEP,IAAI,CAACO,KAAL,CAAWC,OAAX,CAAmBL,gBAAnB,EAAqCD,aAArC,CAFI;AAGXO,QAAAA,MAAM,EAAET,IAAI,CAACS,MAAL,CAAYD,OAAZ,CAAoBL,gBAApB,EAAsCD,aAAtC,CAHG;AAIXQ,QAAAA,eAAe,eAAQV,IAAI,CAACW,WAAL,CAAiBH,OAAjB,CAAyBL,gBAAzB,EAA2CD,aAA3C,CAAR;AAJJ,OAAf;AAMA,aAAOG,MAAP;AACH,K;;oEACe,UAACO,QAAD,EAAWX,WAAX,EAAwBC,aAAxB,EAA0C;AACtD,UAAG,CAACU,QAAD,IAAaA,QAAQ,CAACC,MAAT,GAAgB,CAAhC,EAAkC;AAC9B;AACH;;AACDD,MAAAA,QAAQ,CAACE,KAAT,CAAeC,GAAf,CAAmB,UAAAC,IAAI,EAAE;AACrB,cAAKC,KAAL,CAAWC,YAAX,CAAwBC,MAAxB,CAA+B;AAC3BC,UAAAA,QAAQ,EAAEzB,eADiB;AAE3B0B,UAAAA,SAAS,EAAC;AAACC,YAAAA,KAAK,EAAC,MAAKC,aAAL,CAAmBP,IAAI,CAACQ,IAAxB,EAA8BvB,WAA9B,EAA2CC,aAA3C;AAAP;AAFiB,SAA/B,EAICuB,IAJD,CAIM,UAAAC,QAAQ,EAAE;AACZC,UAAAA,OAAO,CAACC,GAAR,CAAYF,QAAZ;AACH,SAND;AAOH,OARD;AASH,K;;;;;;;qCAEgB3B,a,EAAc;AAC3B4B,MAAAA,OAAO,CAACC,GAAR,CAAY7B,aAAZ;AACA,aAAO,KAAK8B,QAAL,CAAc;AAAC9B,QAAAA,aAAa,EAAbA;AAAD,OAAd,CAAP;AACH;;;+BAEU+B,Q,EAAS;AAChB,aAAO,aAAYA,QAAZ,EAAsBf,GAAtB,CAA0B,UAACgB,GAAD,EAAO;AACpC,iCAAWD,QAAQ,CAACC,GAAD,CAAnB;AAA0BA,UAAAA,GAAG,EAAHA;AAA1B;AACH,OAFM,CAAP;AAGH;;;wCAEkB;AACf,UAAMjC,SAAS,GAAGR,KAAK,CAAC0C,GAAN,CAAU,UAAV,IAAwB1C,KAAK,CAAC0C,GAAN,CAAU,UAAV,CAAxB,GAAgD,EAAlE;AACA,UAAMC,OAAO,GAAG3C,KAAK,CAAC0C,GAAN,CAAU,QAAV,IAAsB1C,KAAK,CAAC0C,GAAN,CAAU,QAAV,CAAtB,GAA4C,EAA5D;AACA1C,MAAAA,KAAK,CAAC4C,GAAN,CAAU,QAAV,EAAmB,EAAnB;AACAP,MAAAA,OAAO,CAACC,GAAR,CAAY9B,SAAZ;AACA6B,MAAAA,OAAO,CAACC,GAAR,CAAYK,OAAZ;AACA,WAAKJ,QAAL,CAAc;AAAC/B,QAAAA,SAAS,EAATA,SAAD;AAAYmC,QAAAA,OAAO,EAAPA;AAAZ,OAAd;AACH;;;gCACWF,G,EAAI;AAAA;;AAAA,kCAC0B,KAAKI,KAAL,CAAWrC,SAAX,CAAqBiC,GAArB,CAD1B;AAAA,UACJ9B,WADI,yBACJA,WADI;AAAA,UACSC,aADT,yBACSA,aADT;AAEZ,WAAKe,KAAL,CAAWC,YAAX,CAAwBkB,KAAxB,CAA8B;AAC1BA,QAAAA,KAAK,EAAExC,eADmB;AAE1ByB,QAAAA,SAAS,EAAC;AAACpB,UAAAA,WAAW,EAAXA;AAAD;AAFgB,OAA9B,EAICwB,IAJD,CAIM,UAAAC,QAAQ,EAAE;AACZ,YAAGA,QAAQ,IAAIA,QAAQ,CAAC1B,IAArB,IAA6B0B,QAAQ,CAAC1B,IAAT,CAAcY,QAA9C,EAAuD;AACnD,UAAA,MAAI,CAACyB,aAAL,CAAmBX,QAAQ,CAAC1B,IAAT,CAAcY,QAAjC,EAA0CX,WAA1C,EAAuDC,aAAvD;AACH,SAFD,MAEK;AACDyB,UAAAA,OAAO,CAACC,GAAR,CAAY,eAAZ;AACH;AACJ,OAVD;AAWH;;;mCACcG,G,EAAI;AAAA,UACPjC,SADO,GACO,KAAKqC,KADZ,CACPrC,SADO;AAEf,aAAOA,SAAS,CAACiC,GAAD,CAAhB;AACAzC,MAAAA,KAAK,CAAC4C,GAAN,CAAU,UAAV,EAAqBpC,SAArB;AACA,WAAK+B,QAAL,CAAc;AAAC/B,QAAAA,SAAS,EAATA;AAAD,OAAd;AACH;;;mCAEa;AAAA,wBACqB,KAAKqC,KAD1B;AAAA,UACFrC,SADE,eACFA,SADE;AAAA,UACSmC,OADT,eACSA,OADT;AAEV,UAAMK,SAAS,GAAG,KAAKH,KAAL,CAAWpC,aAAX,CAAyBwC,MAAzB,CAAgC,UAACC,MAAD,EAAST,GAAT,EAAe;AAC7DS,QAAAA,MAAM,GAAGA,MAAM,CAACC,IAAP,CAAY3C,SAAS,CAACiC,GAAD,CAArB,CAAT;AACA,eAAOjC,SAAS,CAACiC,GAAD,CAAhB;AACH,OAHiB,EAGhB,EAHgB,CAAlB;AAIA,UAAMW,YAAY,GAAG,YAAU,KAAKP,KAAL,CAAWpC,aAAX,CAAyB4C,IAAzB,CAA8B,GAA9B,CAA/B;AACAhB,MAAAA,OAAO,CAACC,GAAR,CAAYU,SAAZ;AACAX,MAAAA,OAAO,CAACC,GAAR,CAAYc,YAAZ;AACAf,MAAAA,OAAO,CAACC,GAAR,CAAY9B,SAAZ;AACAR,MAAAA,KAAK,CAAC4C,GAAN,CAAU,UAAV,EAAqBpC,SAArB;;AACA,UAAI,CAACR,KAAK,CAAC0C,GAAN,CAAU,QAAV,CAAL,EAAyB;AACrBL,QAAAA,OAAO,CAACC,GAAR,CAAY,mBAAZ;AACAtC,QAAAA,KAAK,CAAC4C,GAAN,CAAU,QAAV,sBAAqBQ,YAArB,EAAmCJ,SAAnC;AACH,OAHD,MAGK;AACDhD,QAAAA,KAAK,CAAC4C,GAAN,CAAU,QAAV,oBAAuBD,OAAvB,sBAAiCS,YAAjC,EAA+CJ,SAA/C;AACH;;AACD,WAAKT,QAAL,CAAc;AAAC9B,QAAAA,aAAa,EAAC;AAAf,OAAd;AACH;;;6BAEQgC,G,EAAI;AAAA,yBACsB,KAAKI,KAD3B;AAAA,UACDrC,SADC,gBACDA,SADC;AAAA,UACUmC,OADV,gBACUA,OADV;AAET,UAAMO,MAAM,GAAGP,OAAO,CAACF,GAAD,CAAtB;AACAS,MAAAA,MAAM,CAACzB,GAAP,CAAW,UAAA6B,GAAG,EAAI;AACd,YAAMC,SAAS,GAAG,aAAYD,GAAZ,EAAiBE,IAAjB,GAAwB/B,GAAxB,CAA4B,UAAAgC,CAAC;AAAA,iBAAIH,GAAG,CAACG,CAAD,CAAH,CAAOC,QAAP,EAAJ;AAAA,SAA7B,EAAoDL,IAApD,CAAyD,GAAzD,CAAlB;;AACA7C,QAAAA,SAAS,CAAC+C,SAAD,CAAT,GAAuBD,GAAvB;AACH,OAHD;AAIA,aAAOX,OAAO,CAACF,GAAD,CAAd;AACAJ,MAAAA,OAAO,CAACC,GAAR,CAAYK,OAAZ;AACAN,MAAAA,OAAO,CAACC,GAAR,CAAY9B,SAAZ;AACAR,MAAAA,KAAK,CAAC4C,GAAN,CAAU,UAAV,EAAqBpC,SAArB;AACAR,MAAAA,KAAK,CAAC4C,GAAN,CAAU,QAAV,EAAmBD,OAAnB;AACA,WAAKJ,QAAL,CAAc;AAAC/B,QAAAA,SAAS,EAATA,SAAD;AAAYmC,QAAAA,OAAO,EAAPA;AAAZ,OAAd;AACH;;;8BAESF,G,EAAI;AAAA;;AACV,UAAMS,MAAM,GAAG,KAAKL,KAAL,CAAWF,OAAX,CAAmBF,GAAnB,CAAf;AACAS,MAAAA,MAAM,CAACzB,GAAP,CAAW,UAAA6B,GAAG,EAAI;AAAA,YACN3C,WADM,GACwB2C,GADxB,CACN3C,WADM;AAAA,YACOC,aADP,GACwB0C,GADxB,CACO1C,aADP;;AAEd,QAAA,MAAI,CAACe,KAAL,CAAWC,YAAX,CAAwBkB,KAAxB,CAA8B;AAC1BA,UAAAA,KAAK,EAAExC,eADmB;AAE1ByB,UAAAA,SAAS,EAAC;AAACpB,YAAAA,WAAW,EAAXA;AAAD;AAFgB,SAA9B,EAICwB,IAJD,CAIM,UAAAC,QAAQ,EAAE;AACZ,cAAGA,QAAQ,IAAIA,QAAQ,CAAC1B,IAArB,IAA6B0B,QAAQ,CAAC1B,IAAT,CAAcY,QAA9C,EAAuD;AACnD,YAAA,MAAI,CAACyB,aAAL,CAAmBX,QAAQ,CAAC1B,IAAT,CAAcY,QAAjC,EAA0CX,WAA1C,EAAuDC,aAAvD;AACH,WAFD,MAEK;AACDyB,YAAAA,OAAO,CAACC,GAAR,CAAY,eAAZ;AACH;AACJ,SAVD;AAWH,OAbD;AAcH;;;6BAEQ;AAAA;;AACP,UAAMqB,GAAG,GAAG,KAAKC,OAAjB;;AACA,UAAMC,iBAAiB,GAAG,SAApBA,iBAAoB,GAAM;AAC9B,YAAMC,QAAQ,GAAG7D,QAAQ,CAAC8D,MAAT,CAAgBJ,GAAhB,CAAjB;AACAG,QAAAA,QAAQ,CAACE,QAAT,CACE/D,QAAQ,CAACgE,MAAT,CAAgBC,GADlB,EAEE,gBAFF;AAID,OAND;;AAOF,aACI,mBACA,MAAC,IAAD,QACA,MAAC,YAAD;AACI,QAAA,YAAY,EAAE;AAACC,UAAAA,QAAQ,EAAE,UAAX;AAAuBC,UAAAA,MAAM,EAAE;AAA/B,SADlB;AAEI,QAAA,KAAK,EAAE,KAAKC,UAAL,CAAgB,KAAKxB,KAAL,CAAWrC,SAA3B,CAFX;AAGI,QAAA,aAAa,EAAE,KAAKqC,KAAL,CAAWpC,aAH9B;AAII,QAAA,iBAAiB,EAAE,KAAK6D,gBAAL,CAAsBC,IAAtB,CAA2B,IAA3B,CAJvB;AAKI,QAAA,UAAU,MALd;AAMI,QAAA,mBAAmB,EAAE,CACjB;AACEC,UAAAA,OAAO,EAAE,QADX;AAEEC,UAAAA,QAAQ,EAAE;AAAA,mBAAI,MAAI,CAACC,YAAL,EAAJ;AAAA;AAFZ,SADiB,CANzB;AAYI,QAAA,UAAU,EAAE,oBAAChD,IAAD,EAAU;AAAA,cACfe,GADe,GAC+Bf,IAD/B,CACfe,GADe;AAAA,cACV9B,WADU,GAC+Be,IAD/B,CACVf,WADU;AAAA,cACGC,aADH,GAC+Bc,IAD/B,CACGd,aADH;AAAA,cACkB+D,SADlB,GAC+BjD,IAD/B,CACkBiD,SADlB;AAEtB,cAAMC,eAAe,GAAG,CACpB;AACIJ,YAAAA,OAAO,EAAE,KADb;AAEIC,YAAAA,QAAQ,EAAE;AAAA,qBAAI,MAAI,CAACI,WAAL,CAAiBpC,GAAjB,CAAJ;AAAA;AAFd,WADoB,EAIjB;AACC+B,YAAAA,OAAO,EAAE,QADV;AAECC,YAAAA,QAAQ,EAAE;AAAA,qBAAI,MAAI,CAACK,cAAL,CAAoBrC,GAApB,CAAJ;AAAA;AAFX,WAJiB,CAAxB;AASA,iBACI,MAAC,YAAD;AACA,YAAA,EAAE,EAAEA,GADJ;AAEA,YAAA,GAAG,EAAE,KAFL;AAGA,YAAA,eAAe,EAAEmC,eAHjB;AAIA,YAAA,IAAI,EAAEjE;AAJN,aAMA,kBACI,MAAC,SAAD;AAAW,YAAA,SAAS,EAAC;AAArB,aAA+BA,WAA/B,CADJ,CANA,EASA,uCAAqBC,aAArB,SAAsC+D,SAAS,GAAG,kBAAH,GAAwB,oBAAvE,CATA,CADJ;AAaC;AApCL,QADA,CADA,CADJ;AA4ED;;;;EAlNoCI,KAAK,CAACC,S;;gBAAvCzE,wB,iBACmBL,O;;AAoNxB,eAAeK,wBAAf","sourcesContent":["import gql from 'graphql-tag';\nimport { Query, Mutation } from 'react-apollo';\nimport { Card,\n    ResourceList,\n    Stack,\n    TextStyle,\n    ResourceItem,\n    TextField,\n    Thumbnail,\n    DataTable,\n    Button,\n    Checkbox,\n    Icon\n } from '@shopify/polaris';\n import {\n  StarFilledMinor,\n  StarOutlineMinor\n} from '@shopify/polaris-icons';\nimport store from 'store-js';\nimport { Redirect } from '@shopify/app-bridge/actions';\nimport { Context } from '@shopify/app-bridge-react';\nimport { useMutation } from '@apollo/react-hooks';\nimport _ from 'lodash'\nimport './ResourceList.css'\nimport{ UPDATE_PRODUCTS, SEARCH_PRODUCTS }from \"./graphql.js\"\n\nclass ResourceListWithProducts extends React.Component {\n    static contextType = Context;\n    state = {\n        favorites:[],\n        selectedItems: [],\n\n    }\n    transformData = (data, searchquery, replacestring)=>{\n        const regexsearchquery = new RegExp(searchquery, \"gi\");\n        const result = {\n            id:data.id,\n            title: data.title.replace(regexsearchquery, replacestring),\n            handle: data.handle.replace(regexsearchquery, replacestring),\n            descriptionHtml: `<p>${data.description.replace(regexsearchquery, replacestring)}</p>`,\n        }\n        return result\n    }\n    handleReplace = (products, searchquery, replacestring) => {\n        if(!products || products.length<1){\n            return \n        }\n        products.edges.map(item=>{\n            this.props.apolloClient.mutate({\n                mutation: UPDATE_PRODUCTS,\n                variables:{input:this.transformData(item.node, searchquery, replacestring)}\n            })\n            .then(response=>{\n                console.log(response)\n            })\n        })\n    }\n\n    setSelectedItems(selectedItems){\n        console.log(selectedItems)\n        return this.setState({selectedItems})\n    }\n\n    ObjtoArray(favorite){\n        return Object.keys(favorite).map((key)=>{\n            return {...favorite[key], key}\n        })\n    }\n\n    componentDidMount(){\n        const favorites = store.get(\"favorite\") ? store.get(\"favorite\") : {}\n        const bundles = store.get(\"bundle\") ? store.get(\"bundle\") : {}\n        store.set(\"bundle\",{})\n        console.log(favorites)\n        console.log(bundles)\n        this.setState({favorites, bundles})\n    }\n    runFavorite(key){\n        const  {searchquery, replacestring} = this.state.favorites[key]\n        this.props.apolloClient.query({\n            query: SEARCH_PRODUCTS,\n            variables:{searchquery}\n        })\n        .then(response=>{\n            if(response && response.data && response.data.products){\n                this.handleReplace(response.data.products,searchquery, replacestring)\n            }else{\n                console.log(\"no item found\")\n            }\n        })\n    }\n    removeFavorite(key){\n        const { favorites } = this.state\n        delete favorites[key]\n        store.set(\"favorite\",favorites)\n        this.setState({favorites})\n    }\n\n    createBundle(){\n        const { favorites, bundles } = this.state\n        const newbundle = this.state.selectedItems.reduce((bundle, key)=>{\n            bundle = bundle.push(favorites[key])\n            delete favorites[key]\n        },[])\n        const newbundlekey = \"bundle:\"+this.state.selectedItems.join(';')\n        console.log(newbundle)\n        console.log(newbundlekey)\n        console.log(favorites)\n        store.set(\"favorite\",favorites)\n        if (!store.get('bundle')){\n            console.log(\"no current bundle\")\n            store.set(\"bundle\",{[newbundlekey]:newbundle})\n        }else{\n            store.set(\"bundle\",{...bundles, [newbundlekey]:newbundle})\n        }\n        this.setState({selectedItems:[]})\n    }\n    \n    unbundle(key){\n        const { favorites, bundles } = this.state\n        const bundle = bundles[key]\n        bundle.map(fav => {\n            const hashedfav = Object.keys(fav).sort().map(x => fav[x].toString()).join(\";\");\n            favorites[hashedfav] = fav\n        })\n        delete bundles[key]\n        console.log(bundles)\n        console.log(favorites)\n        store.set(\"favorite\",favorites)\n        store.set(\"bundle\",bundles)\n        this.setState({favorites, bundles})\n    }\n\n    runBundle(key){\n        const bundle = this.state.bundles[key]\n        bundle.map(fav => {\n            const  {searchquery, replacestring} = fav\n            this.props.apolloClient.query({\n                query: SEARCH_PRODUCTS,\n                variables:{searchquery}\n            })\n            .then(response=>{\n                if(response && response.data && response.data.products){\n                    this.handleReplace(response.data.products,searchquery, replacestring)\n                }else{\n                    console.log(\"no item found\")\n                }\n            })\n        })\n    }\n    \n    render() {\n      const app = this.context;\n      const redirectToProduct = () => {\n        const redirect = Redirect.create(app);\n        redirect.dispatch(\n          Redirect.Action.APP,\n          '/edit-products',\n        );\n      };\n    return (\n        <div>\n        <Card>\n        <ResourceList\n            resourceName={{singular: 'favorite', plural: 'favorites'}}\n            items={this.ObjtoArray(this.state.favorites)}\n            selectedItems={this.state.selectedItems}\n            onSelectionChange={this.setSelectedItems.bind(this)}\n            selectable\n            promotedBulkActions={[\n                {\n                  content: 'Bundle',\n                  onAction: ()=>this.createBundle(),\n                }\n            ]}\n            renderItem={(item) => {\n            const {key, searchquery, replacestring, matchcase} = item;\n            const shortcutActions = [\n                {\n                    content: 'Run',\n                    onAction: ()=>this.runFavorite(key),\n                }, {\n                    content: 'Remove',\n                    onAction: ()=>this.removeFavorite(key),\n                }]\n              \n            return (\n                <ResourceItem\n                id={key}\n                url={\"url\"}\n                shortcutActions={shortcutActions}\n                name={searchquery}\n                >\n                <h3>\n                    <TextStyle variation=\"strong\">{searchquery}</TextStyle>\n                </h3>\n                <div>Replace with :\"{replacestring}\" {matchcase ? \"(Case Sensitive)\" : \"(Case Insensitive)\"}</div>\n                </ResourceItem>\n            );\n            }}\n        />\n        </Card>\n{/* \n        <Card>\n        <ResourceList\n            resourceName={{singular: 'bundle', plural: 'bundles'}}\n            items={this.ObjtoArray(this.state.bundles)}\n            renderItem={(item) => {\n            const {key, searchquery, replacestring, matchcase} = item;\n            const shortcutActions = [\n                {\n                    content: 'Run',\n                    onAction: ()=>this.runBundle(key),\n                }, {\n                    content: 'Unbundle',\n                    onAction: ()=>this.unbundle(key),\n                }]\n              \n            return (\n                <ResourceItem\n                id={key}\n                url={\"url\"}\n                shortcutActions={shortcutActions}\n                name={searchquery}\n                >\n                <h3>\n                    <TextStyle variation=\"strong\">{searchquery}</TextStyle>\n                </h3>\n                <div>Replace with :\"{replacestring}\" {matchcase ? \"(Case Sensitive)\" : \"(Case Insensitive)\"}</div>\n                </ResourceItem>\n            );\n            }}\n        />\n        </Card> */}\n        </div>\n    );\n  }\n}\n\n export default ResourceListWithProducts;"]},"metadata":{},"sourceType":"module"}